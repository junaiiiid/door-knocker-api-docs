openapi: 3.0.3
info:
  title: Door Knocker Campaign Management API
  description: |
    Complete campaign management system with role-based authentication, address discovery, verification, and organization management built with Supabase Edge Functions and Supabase Auth.

    ## Features
    - Role-based access control (ADMIN, MARKETER, TECHNICIAN)
    - User registration with role assignment
    - Organization management with multi-user support
    - Campaign creation and management (6-step workflow)
    - Address discovery using OpenStreetMap with Google Maps/Nominatim geocoding
    - PostGrid address verification integration
    - Location zones with verified addresses
    - Campaign disclaimers and consents
    - Referral management system
    - Image gallery for before/after photos
    - PostGrid template integration
    - Secure authentication using Supabase Auth
    - JWT-based session management
    - Password reset flow
    - Row Level Security (RLS) policies
    - CORS support
    - Comprehensive error handling

    ## User Roles
    - **ADMIN**: Full system access, owns organization, can manage all users and create team members
    - **MARKETER**: Marketing team member, associated with an organization
    - **TECHNICIAN**: Technical operations team member, associated with an organization

    ## Campaign Workflow (6 Steps)
    1. **Link Referral** - Associate referral with campaign
    2. **Select Template** - Choose PostGrid postcard template
    3. **Add Offer Details** - Set headline, description, dates, CTA, disclaimer
    4. **Add Business Details** - Business info, contact, QR code, before/after images
    5. **Link Location Zone** - Associate verified address zone with campaign
    6. **Campaign Consents** - Accept required disclaimers and consents

    ## Address Discovery & Verification
    - Uses OpenStreetMap Overpass API to find buildings in a radius
    - Optional Google Maps API for accurate reverse geocoding (recommended)
    - Falls back to OpenStreetMap Nominatim for geocoding
    - PostGrid integration for address verification
    - Saves zones with verified addresses to database
    - Filters by building type (ALL, RESIDENTIAL, OTHER)

    ## Organization Management
    - ADMIN users automatically get an organization on signup
    - Organization stores business information (name, address, contact details)
    - Team members (MARKETER/TECHNICIAN) are automatically added to organization_members
    - Role-based organization retrieval (owner vs member access)
    - All campaigns, referrals, and zones are organization-scoped

    ## Security
    - Strong password requirements enforced:
      - Minimum 8 characters
      - At least one uppercase letter (A-Z)
      - At least one lowercase letter (a-z)
      - At least one number (0-9)
      - At least one special character (!@#$%^&* etc.)
    - Passwords managed by Supabase Auth
    - JWT access tokens for authentication
    - Row Level Security (RLS) on database tables
    - Only ADMINs can create other users and manage organizations
    - Secure password reset with one-time tokens

  version: 3.0.0
  contact:
    name: Door Knocker API Support
    email: support@doorknocker.example.com

servers:
  - url: https://iywivotqnphrjijztxtu.supabase.co/functions/v1
    description: Production server
  - url: http://localhost:54321/functions/v1
    description: Local development server

security:
  - SupabaseAuth: []

tags:
  - name: Authentication
    description: User authentication and registration operations
  - name: User Management
    description: User profile and information operations
  - name: Password Management
    description: Password reset operations
  - name: Organization Management
    description: Organization information and management operations
  - name: Job Management
    description: Job types and job-related operations
  - name: Referral Management
    description: Referral creation, retrieval, and management operations
  - name: Gallery Management
    description: Photo gallery and image management operations for referrals
  - name: Campaign Management
    description: Campaign creation, management, and PostGrid template operations
  - name: Template Management
    description: PostGrid template creation, retrieval, and deletion operations
  - name: Settings Management
    description: User settings, branding, and font management operations
  - name: Address Discovery
    description: Address discovery and verification operations

paths:
  /signUp:
    post:
      tags:
        - Authentication
      summary: Register a new ADMIN user and create organization
      description: |
        Creates a new ADMIN user account with email and password, and automatically creates an associated organization.

        **Important:**
        - This endpoint is for public ADMIN user registration only
        - Role is always set to ADMIN (cannot be changed)
        - Automatically creates an empty organization entry for the ADMIN
        - Organization can be updated later via /saveOrganization endpoint
        - MARKETER and TECHNICIAN users must be created by ADMIN via /createUser endpoint
        - No authentication required for ADMIN signup
      operationId: signUp
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                fullName:
                  type: string
                password:
                  type: string
                  format: password
                  minLength: 8
                  description: |
                    Password must meet the following requirements:
                    - At least 8 characters long
                    - At least one uppercase letter (A-Z)
                    - At least one lowercase letter (a-z)
                    - At least one number (0-9)
                    - At least one special character (!@#$%^&* etc.)
            example:
              email: admin@example.com
              password: SecurePass123!
              fullName: Admin User
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignUpResponse'
              example:
                status: success
                message: User created successfully
                user:
                  id: 550e8400-e29b-41d4-a716-446655440000
                  email: admin@example.com
                  fullName: Admin User
                  role: ADMIN
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingFields:
                  summary: Missing required fields
                  value:
                    error: INVALID_INPUT
                    message: Email and password are required
                invalidEmail:
                  summary: Invalid email format
                  value:
                    error: INVALID_EMAIL
                    message: Invalid email format
                weakPassword:
                  summary: Password too weak - too short
                  value:
                    error: WEAK_PASSWORD
                    message: Password must be at least 8 characters long
                missingUppercase:
                  summary: Password missing uppercase letter
                  value:
                    error: WEAK_PASSWORD
                    message: Password must contain at least one uppercase letter
                missingLowercase:
                  summary: Password missing lowercase letter
                  value:
                    error: WEAK_PASSWORD
                    message: Password must contain at least one lowercase letter
                missingNumber:
                  summary: Password missing number
                  value:
                    error: WEAK_PASSWORD
                    message: Password must contain at least one number
                missingSpecialChar:
                  summary: Password missing special character
                  value:
                    error: WEAK_PASSWORD
                    message: Password must contain at least one special character (!@#$%^&* etc.)
                invalidRole:
                  summary: Invalid role - trying to create non-ADMIN user
                  value:
                    error: INVALID_ROLE
                    message: signUp endpoint only creates ADMIN users. Use /createUser endpoint for MARKETER and TECHNICIAN roles.
        '409':
          description: Email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: EMAIL_EXISTS
                message: An account with this email already exists
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /createUser:
    post:
      tags:
        - User Management
      summary: Create MARKETER or TECHNICIAN user and add to organization (ADMIN only)
      description: |
        Allows ADMIN users to create new MARKETER or TECHNICIAN users and automatically adds them to the organization.

        **Access Control:**
        - Only authenticated ADMIN users can access this endpoint
        - Cannot create ADMIN users via this endpoint (use /signUp for ADMIN creation)
        - Requires valid JWT Bearer token from an ADMIN user

        **Automatic Organization Membership:**
        - Created user is automatically added to the ADMIN's organization_members array
        - Includes member_uid and member_role in the organization record

        **Created User Roles:**
        - MARKETER: Marketing-specific dashboard access, member of organization
        - TECHNICIAN: Technical operations dashboard access, member of organization
      operationId: createUser
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - role
              properties:
                email:
                  type: string
                  format: email
                  description: Email address for the new user
                password:
                  type: string
                  format: password
                  minLength: 8
                  description: |
                    Password must meet the following requirements:
                    - At least 8 characters long
                    - At least one uppercase letter (A-Z)
                    - At least one lowercase letter (a-z)
                    - At least one number (0-9)
                    - At least one special character (!@#$%^&* etc.)
                fullName:
                  type: string
                  description: Full name of the user
                role:
                  type: string
                  enum: [MARKETER, TECHNICIAN]
                  description: "Role to assign (MARKETER or TECHNICIAN only)"
            examples:
              marketer:
                summary: Create marketer user
                value:
                  email: marketer@example.com
                  password: SecurePass123!
                  fullName: Jane Marketer
                  role: MARKETER
              technician:
                summary: Create technician user
                value:
                  email: tech@example.com
                  password: SecurePass123!
                  fullName: John Technician
                  role: TECHNICIAN
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignUpResponse'
              example:
                status: success
                message: User created successfully
                user:
                  id: 660e8400-e29b-41d4-a716-446655440001
                  email: marketer@example.com
                  fullName: Jane Marketer
                  role: MARKETER
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingFields:
                  summary: Missing required fields
                  value:
                    error: INVALID_INPUT
                    message: Email, password, and role are required
                invalidEmail:
                  summary: Invalid email format
                  value:
                    error: INVALID_EMAIL
                    message: Invalid email format
                weakPassword:
                  summary: Password too weak - too short
                  value:
                    error: WEAK_PASSWORD
                    message: Password must be at least 8 characters long
                missingUppercase:
                  summary: Password missing uppercase letter
                  value:
                    error: WEAK_PASSWORD
                    message: Password must contain at least one uppercase letter
                missingLowercase:
                  summary: Password missing lowercase letter
                  value:
                    error: WEAK_PASSWORD
                    message: Password must contain at least one lowercase letter
                missingNumber:
                  summary: Password missing number
                  value:
                    error: WEAK_PASSWORD
                    message: Password must contain at least one number
                missingSpecialChar:
                  summary: Password missing special character
                  value:
                    error: WEAK_PASSWORD
                    message: Password must contain at least one special character (!@#$%^&* etc.)
                invalidRole:
                  summary: Invalid role
                  value:
                    error: INVALID_ROLE
                    message: Invalid role. Must be MARKETER or TECHNICIAN
                adminRole:
                  summary: Attempting to create ADMIN user
                  value:
                    error: INVALID_ROLE
                    message: Cannot create ADMIN users via this endpoint. ADMIN users should use /signUp endpoint.
        '401':
          description: Unauthorized - Missing or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingAuth:
                  summary: Missing authorization header
                  value:
                    error: UNAUTHORIZED
                    message: Authorization header is required. Only ADMIN users can create users.
                invalidToken:
                  summary: Invalid token
                  value:
                    error: INVALID_TOKEN
                    message: Invalid or expired token
        '403':
          description: Forbidden - Non-admin user attempting to create users
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: FORBIDDEN
                message: Only ADMIN users can create new users
        '409':
          description: Email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: EMAIL_EXISTS
                message: An account with this email already exists
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /login:
    post:
      tags:
        - Authentication
      summary: Login existing user
      description: |
        Authenticates a user with email and password using Supabase Auth.
        Returns JWT access token, refresh token, and user information including their role.

        **Token Information:**
        - Access token expires in 1 hour (3600 seconds)
        - Refresh token can be used to obtain new access tokens via /refreshToken endpoint
        - Store both tokens securely on the client side
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              email: user@example.com
              password: SecurePass123!
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
              example:
                status: success
                message: Login successful
                token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                refreshToken: xYz123RefreshToken456...
                expiresIn: 3600
                role: TECHNICIAN
                user:
                  id: 550e8400-e29b-41d4-a716-446655440000
                  email: user@example.com
                  fullName: John Doe
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingFields:
                  summary: Missing required fields
                  value:
                    error: INVALID_INPUT
                    message: Email and password are required
                invalidEmail:
                  summary: Invalid email format
                  value:
                    error: INVALID_EMAIL
                    message: Invalid email format
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: INVALID_CREDENTIALS
                message: Invalid email or password
        '404':
          description: User profile not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: PROFILE_NOT_FOUND
                message: User profile not found. Please contact support.
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /logout:
    post:
      tags:
        - Authentication
      summary: Logout user
      description: |
        Invalidates the user's current session.
        Requires a valid JWT token in the Authorization header.
        Client should also clear local storage/cookies after logout.
      operationId: logout
      security:
        - SupabaseAuth: []
        - BearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
              example:
                status: success
                message: Logout successful
        '401':
          description: Unauthorized - Missing or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingAuth:
                  summary: Missing authorization header
                  value:
                    error: UNAUTHORIZED
                    message: Authorization header is required
                invalidToken:
                  summary: Invalid token
                  value:
                    error: INVALID_TOKEN
                    message: Invalid or expired token
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /refreshToken:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: |
        Exchanges a refresh token for a new access token and refresh token pair.

        **Use Case:**
        - When the access token expires (after 1 hour)
        - Client receives 401 error from protected endpoints
        - Use this endpoint to get new tokens without re-login

        **Token Rotation:**
        - Returns both new access token AND new refresh token
        - Store both tokens and use the new refresh token for next refresh
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
                  description: The refresh token obtained from login
            example:
              refreshToken: xYz123RefreshToken456...
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Token refreshed successfully
                  token:
                    type: string
                    description: New access token
                  refreshToken:
                    type: string
                    description: New refresh token
                  expiresIn:
                    type: number
                    description: Token expiry time in seconds
                    example: 3600
              example:
                status: success
                message: Token refreshed successfully
                token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                refreshToken: aBc456NewRefreshToken789...
                expiresIn: 3600
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: INVALID_INPUT
                message: Refresh token is required
        '401':
          description: Invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: INVALID_TOKEN
                message: Invalid or expired refresh token
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getUser:
    get:
      tags:
        - User Management
      summary: Fetch user profile and role
      description: |
        Retrieves the authenticated user's profile information including role, email, and full name.

        **Admin Access:**
        - ADMIN users can fetch any user's profile by providing the `user_id` query parameter
        - Non-admin users can only fetch their own profile

        **Returns:**
        - User ID, email, role, full name, and account creation date
      operationId: getUser
      security:
        - SupabaseAuth: []
        - BearerAuth: []
      parameters:
        - name: user_id
          in: query
          required: false
          description: "User ID to fetch (ADMIN only). If omitted, returns the authenticated user's profile."
          schema:
            type: string
            format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetUserResponse'
              examples:
                ownProfile:
                  summary: Get own profile
                  value:
                    status: success
                    data:
                      id: 550e8400-e29b-41d4-a716-446655440000
                      email: tech@example.com
                      role: TECHNICIAN
                      full_name: John Technician
                      created_at: '2025-01-13T10:00:00.000Z'
                adminViewingOther:
                  summary: Admin viewing another user (with user_id param)
                  value:
                    status: success
                    data:
                      id: 660e8400-e29b-41d4-a716-446655440001
                      email: marketer@example.com
                      role: MARKETER
                      full_name: Jane Marketer
                      created_at: '2025-01-12T15:30:00.000Z'
        '401':
          description: Unauthorized - Missing or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingAuth:
                  summary: Missing authorization header
                  value:
                    error: UNAUTHORIZED
                    message: Authorization header is required
                invalidToken:
                  summary: Invalid token
                  value:
                    error: INVALID_TOKEN
                    message: Invalid or expired token
        '403':
          description: Forbidden - Non-admin trying to access another user's profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: FORBIDDEN
                message: Only ADMIN users can view other users' profiles
        '404':
          description: User or profile not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                userNotFound:
                  summary: User not found
                  value:
                    error: USER_NOT_FOUND
                    message: User not found
                profileNotFound:
                  summary: Profile not found
                  value:
                    error: PROFILE_NOT_FOUND
                    message: User profile not found. Please contact support.
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getAppContent:
    get:
      tags:
        - Settings Management
      summary: Get role-based application content and branding
      description: |
        Retrieves application content configuration and user branding settings based on the authenticated user's role and organization.

        **Role-Based Access:**
        - **ADMIN**: Full access to all application features
        - **MARKETER**: Access to campaigns, referrals, analytics, targeting, and notifications
        - **TECHNICIAN**: Access to referrals and notifications only
        - **All roles**: Get notifications and basic navigation

        **Organization-Based:**
        - Content is scoped to the user's organization
        - Each organization can have customized menu configurations
        - Auto-creates default content if not found

        **User Branding:**
        - Returns user-specific theme settings (colors and fonts)
        - Default theme provided if user hasn't customized

        **Returns:**
        - Menu items array with permissions, titles, descriptions
        - Extended options for complex menu structures
        - Role-appropriate quick actions
        - User branding theme (colors and fonts)
      operationId: getAppContent
      security:
        - SupabaseAuth: []
        - BearerAuth: []
      responses:
        '200':
          description: App content retrieved successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - data
                properties:
                  data:
                    type: object
                    required:
                      - menu_items
                      - theme
                    properties:
                      menu_items:
                        type: array
                        items:
                          $ref: '#/components/schemas/MenuItem'
                      theme:
                        type: object
                        properties:
                          colors:
                            type: object
                            properties:
                              primary:
                                type: string
                                example: "#E36A00"
                              secondary:
                                type: string
                                example: "#1D1D20"
                              accent:
                                type: string
                                example: "#47BAD7"
                          fonts:
                            type: object
                            properties:
                              primary:
                                type: object
                                properties:
                                  name:
                                    type: string
                                    example: "Poppins"
                              body:
                                type: object
                                properties:
                                  name:
                                    type: string
                                    example: "Poppins"
              examples:
                adminContent:
                  summary: ADMIN user content (full access)
                  value:
                    data:
                      menu_items:
                        - name: search_bar
                          title: Search
                          description: Search Job, Referrals & Campaigns
                          id: 0
                          enabled: true
                          extended: false
                          extended_options: []
                        - name: dashboard
                          title: Dashboard
                          description: Create, Navigate, Lead & Iterate
                          id: 1
                          enabled: true
                          extended: false
                          extended_options: []
                        - name: referrals
                          title: Referrals
                          description: Add Referrals, start Campaigns & Get Leads
                          id: 2
                          enabled: true
                          extended: false
                          extended_options: []
                        - name: campaigns
                          title: Campaigns
                          description: Manage Your Campaigns
                          id: 3
                          enabled: true
                          extended: false
                          extended_options: []
                        - name: templates
                          title: Templates
                          description: Manage Your Templates
                          id: 4
                          enabled: true
                          extended: false
                          extended_options: []
                        - name: targeting
                          title: Targeting
                          description: ""
                          id: 5
                          enabled: true
                          extended: true
                          extended_options:
                            - name: targeting_zones
                              title: Targeting Zones
                              description: Targeting > Targeting Zones
                              id: 51
                              enabled: true
                              extended: false
                              extended_options: []
                        - name: analytics
                          title: Analytics
                          description: ""
                          id: 6
                          enabled: true
                          extended: true
                          extended_options:
                            - name: overview
                              title: Overview
                              description: Analytics > Overview
                              id: 61
                              enabled: true
                              extended: false
                              extended_options: []
                        - name: notifications
                          title: Notifications
                          description: ""
                          id: 8
                          enabled: true
                          extended: false
                          extended_options: []
                        - name: settings
                          title: Settings
                          description: Manage Your Account Settings
                          id: 9
                          enabled: true
                          extended: false
                          extended_options: []
                marketerContent:
                  summary: MARKETER user content (limited access)
                  value:
                    data:
                      menu_items:
                        - name: search_bar
                          title: Search
                          description: Search Job, Referrals & Campaigns
                          id: 0
                          enabled: true
                          extended: false
                          extended_options: []
                        - name: dashboard
                          title: Dashboard
                          description: Create, Navigate, Lead & Iterate
                          id: 1
                          enabled: true
                          extended: false
                          extended_options: []
                        - name: referrals
                          title: Referrals
                          description: Add Referrals, start Campaigns & Get Leads
                          id: 2
                          enabled: true
                          extended: false
                          extended_options: []
                        - name: campaigns
                          title: Campaigns
                          description: Manage Your Campaigns
                          id: 3
                          enabled: true
                          extended: false
                          extended_options: []
                        - name: targeting
                          title: Targeting
                          description: ""
                          id: 5
                          enabled: true
                          extended: true
                          extended_options:
                            - name: targeting_zones
                              title: Targeting Zones
                              description: Targeting > Targeting Zones
                              id: 51
                              enabled: true
                              extended: false
                              extended_options: []
                        - name: analytics
                          title: Analytics
                          description: ""
                          id: 6
                          enabled: true
                          extended: true
                          extended_options:
                            - name: overview
                              title: Overview
                              description: Analytics > Overview
                              id: 61
                              enabled: true
                              extended: false
                              extended_options: []
                        - name: notifications
                          title: Notifications
                          description: ""
                          id: 8
                          enabled: true
                          extended: false
                          extended_options: []
                technicianContent:
                  summary: TECHNICIAN user content (referrals only)
                  value:
                    data:
                      menu_items:
                        - name: search_bar
                          title: Search
                          description: Search Job & Referrals
                          id: 0
                          enabled: true
                          extended: false
                          extended_options: []
                        - name: dashboard
                          title: Dashboard
                          description: View Your Work & Progress
                          id: 1
                          enabled: true
                          extended: false
                          extended_options: []
                        - name: referrals
                          title: Referrals
                          description: Add Referrals & Manage Jobs
                          id: 2
                          enabled: true
                          extended: false
                          extended_options: []
                        - name: quick_actions
                          title: Quick Actions
                          description: ""
                          id: 7
                          enabled: true
                          extended: true
                          extended_options:
                            - name: add_new_referral
                              title: Add New Referral
                              description: ""
                              id: 72
                              enabled: true
                              extended: false
                              extended_options: []
                        - name: notifications
                          title: Notifications
                          description: ""
                          id: 8
                          enabled: true
                          extended: false
                          extended_options: []
        '401':
          description: Unauthorized - Missing or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingAuth:
                  summary: Missing authorization header
                  value:
                    error: UNAUTHORIZED
                    message: Unable to authenticate user
                invalidToken:
                  summary: Invalid token
                  value:
                    error: UNAUTHORIZED
                    message: Unable to authenticate user
        '403':
          description: Forbidden - User not associated with organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: NO_ORGANIZATION
                message: User is not associated with any organization
        '404':
          description: User profile not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: PROFILE_NOT_FOUND
                message: User profile not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /forgotPassword:
    post:
      tags:
        - Password Management
      summary: Request password reset
      description: |
        Sends a password reset email to the user using Supabase Auth.
        Always returns success to prevent email enumeration attacks.

        **Reset Flow:**
        - User receives email with a reset link pointing to: `https://door-knocker-web-app.vercel.app/reset-password`
        - The link contains an access token in the URL parameters
        - Frontend extracts the token and calls /resetPassword endpoint

        The reset email contains a secure link with an access token that can be used
        with the /resetPassword endpoint.
      operationId: forgotPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForgotPasswordRequest'
            example:
              email: user@example.com
      responses:
        '200':
          description: "Request processed (always returns success)"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
              example:
                status: success
                message: If the email exists in our system, a password reset link has been sent
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingEmail:
                  summary: Missing email
                  value:
                    error: INVALID_INPUT
                    message: Email is required
                invalidEmail:
                  summary: Invalid email format
                  value:
                    error: INVALID_EMAIL
                    message: Invalid email format
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /resetPassword:
    post:
      tags:
        - Password Management
      summary: Reset password with token
      description: |
        Resets the user's password using the access token from the password reset email.

        **Flow:**
        1. User receives password reset email from /forgotPassword
        2. User clicks the reset link (contains access_token in URL)
        3. Frontend extracts the access_token and calls this endpoint with new password
        4. Password is updated and user can login with new credentials

        **Security:**
        - New password must meet all password requirements
        - New password cannot be the same as the current password
      operationId: resetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
            example:
              access_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
              newPassword: NewSecurePass123!
      responses:
        '200':
          description: Password reset successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
              example:
                status: success
                message: Password has been reset successfully
        '400':
          description: Invalid input or weak password
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingFields:
                  summary: Missing required fields
                  value:
                    error: INVALID_INPUT
                    message: Access token and new password are required
                weakPassword:
                  summary: Password too weak - too short
                  value:
                    error: WEAK_PASSWORD
                    message: Password must be at least 8 characters long
                missingUppercase:
                  summary: Password missing uppercase letter
                  value:
                    error: WEAK_PASSWORD
                    message: Password must contain at least one uppercase letter
                missingLowercase:
                  summary: Password missing lowercase letter
                  value:
                    error: WEAK_PASSWORD
                    message: Password must contain at least one lowercase letter
                missingNumber:
                  summary: Password missing number
                  value:
                    error: WEAK_PASSWORD
                    message: Password must contain at least one number
                missingSpecialChar:
                  summary: Password missing special character
                  value:
                    error: WEAK_PASSWORD
                    message: Password must contain at least one special character (!@#$%^&* etc.)
                samePassword:
                  summary: New password same as current password
                  value:
                    error: SAME_PASSWORD
                    message: New password cannot be the same as your current password
        '401':
          description: Invalid or expired token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: INVALID_TOKEN
                message: Invalid or expired reset token
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /saveOrganization:
    post:
      tags:
        - Organization Management
      summary: Save/update organization information
      description: |
        Allows authenticated users (typically ADMIN) to update their organization information.

        **Access Control:**
        - Only organization owners can update their organization
        - Updates the organization where owner_id matches the authenticated user's UID

        **Required Fields:**
        - business_name
        - business_address
        - business_email

        **Optional Fields:**
        - registration_number
        - industry
        - phone_number
        - website_url

        **Note:** This endpoint updates an existing organization entry that was created during ADMIN signup.
      operationId: saveOrganization
      security:
        - SupabaseAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveOrganizationRequest'
            example:
              business_name: Tech Solutions Inc
              business_address: 123 Main Street, Silicon Valley, CA 94025
              business_email: contact@techsolutions.com
              registration_number: REG-2025-12345
              industry: Technology
              phone_number: +1-555-123-4567
              website_url: https://techsolutions.com
      responses:
        '200':
          description: Organization updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Organization updated successfully
                  data:
                    $ref: '#/components/schemas/Organization'
              example:
                status: success
                message: Organization updated successfully
                data:
                  id: 770e8400-e29b-41d4-a716-446655440003
                  owner_id: 550e8400-e29b-41d4-a716-446655440000
                  business_name: Tech Solutions Inc
                  business_address: 123 Main Street, Silicon Valley, CA 94025
                  business_email: contact@techsolutions.com
                  registration_number: REG-2025-12345
                  industry: Technology
                  phone_number: +1-555-123-4567
                  website_url: https://techsolutions.com
                  organization_members:
                    - member_uid: 660e8400-e29b-41d4-a716-446655440001
                      member_role: MARKETER
                    - member_uid: 660e8400-e29b-41d4-a716-446655440002
                      member_role: TECHNICIAN
                  created_at: '2025-01-18T10:00:00.000Z'
                  updated_at: '2025-01-18T15:30:00.000Z'
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingFields:
                  summary: Missing required fields
                  value:
                    error: INVALID_INPUT
                    message: business_name, business_address, and business_email are required
                invalidEmail:
                  summary: Invalid business email format
                  value:
                    error: INVALID_EMAIL
                    message: Invalid business email format
        '401':
          description: Unauthorized - Missing or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingAuth:
                  summary: Missing authorization header
                  value:
                    error: UNAUTHORIZED
                    message: Authorization header is required
                invalidToken:
                  summary: Invalid token
                  value:
                    error: INVALID_TOKEN
                    message: Invalid or expired token
        '404':
          description: Organization not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: ORGANIZATION_NOT_FOUND
                message: Organization not found. Please contact support.
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getIndustry:
    get:
      tags:
        - Organization Management
      summary: Get list of available industries
      description: |
        Returns a predefined list of business industries for dropdown selection.

        **Use Case:**
        - Used when users are filling out organization details
        - Provides a standardized list of industry options
        - No authentication required - public endpoint

        **Returns:**
        - Sorted alphabetical list of industries
        - Total count of available industries
      operationId: getIndustry
      responses:
        '200':
          description: Industries retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      industries:
                        type: array
                        items:
                          type: string
                        description: Sorted list of industry names
                        example:
                          - Accounting
                          - Advertising & Marketing
                          - Aerospace & Defense
                          - Agriculture & Farming
                          - Information Technology
                          - Software Development
                      total:
                        type: number
                        description: Total number of industries
                        example: 40
              example:
                status: success
                data:
                  industries:
                    - Accounting
                    - Advertising & Marketing
                    - Aerospace & Defense
                    - Agriculture & Farming
                    - Architecture & Planning
                    - Automotive
                    - Banking & Financial Services
                    - Biotechnology
                    - Construction
                    - Consulting
                    - Consumer Electronics
                    - Consumer Goods
                    - E-commerce
                    - Education & Training
                    - Energy & Utilities
                    - Engineering
                    - Entertainment & Media
                    - Environmental Services
                    - Fashion & Apparel
                    - Food & Beverage
                    - Government & Public Sector
                    - Healthcare & Medical
                    - Hospitality & Tourism
                    - Human Resources
                    - Information Technology
                    - Insurance
                    - Legal Services
                    - Logistics & Supply Chain
                    - Manufacturing
                    - Mining & Metals
                    - Non-Profit & NGO
                    - Oil & Gas
                    - Other
                    - Pharmaceuticals
                    - Real Estate
                    - Retail
                    - Security Services
                    - Software Development
                    - Sports & Recreation
                    - Telecommunications
                    - Transportation
                  total: 40
        '405':
          description: Method not allowed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: METHOD_NOT_ALLOWED
                message: Only GET method is allowed
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getAllJobs:
    get:
      tags:
        - Job Management
      summary: Get all available job types
      description: |
        Returns a comprehensive list of all available job types for construction and home services.

        **Use Case:**
        - Used for dropdown/selection in job creation or scheduling forms
        - Provides standardized list of service types
        - No authentication required - public endpoint
        - Includes 200+ job types across categories: HVAC, Plumbing, Electrical, Roofing, Carpentry, etc.

        **Returns:**
        - Array of job types with id and name
        - Sorted alphabetically by name
      operationId: getAllJobs
      responses:
        '200':
          description: Job types retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                          description: Unique identifier for the job type
                          example: 550e8400-e29b-41d4-a716-446655440000
                        name:
                          type: string
                          description: Name of the job type
                          example: HVAC Installation
              example:
                data:
                  - id: 550e8400-e29b-41d4-a716-446655440000
                    name: AC Installation
                  - id: 660e8400-e29b-41d4-a716-446655440001
                    name: AC Maintenance
                  - id: 770e8400-e29b-41d4-a716-446655440002
                    name: AC Repair
                  - id: 880e8400-e29b-41d4-a716-446655440003
                    name: Appliance Installation
                  - id: 990e8400-e29b-41d4-a716-446655440004
                    name: Appliance Repair
                  - id: aa0e8400-e29b-41d4-a716-446655440005
                    name: Attic Conversion
                  - id: bb0e8400-e29b-41d4-a716-446655440006
                    name: Bathroom Remodeling
                  - id: cc0e8400-e29b-41d4-a716-446655440007
                    name: Carpet Cleaning
                  - id: dd0e8400-e29b-41d4-a716-446655440008
                    name: Concrete Installation
                  - id: ee0e8400-e29b-41d4-a716-446655440009
                    name: Door Installation
                  - id: ff0e8400-e29b-41d4-a716-446655440010
                    name: Drain Cleaning
                  - id: 110e8400-e29b-41d4-a716-446655440011
                    name: Duct Cleaning
                  - id: 220e8400-e29b-41d4-a716-446655440012
                    name: Electrical Installation
                  - id: 330e8400-e29b-41d4-a716-446655440013
                    name: Furnace Tune-Up
                  - id: 440e8400-e29b-41d4-a716-446655440014
                    name: HVAC Installation
                  - id: 5550e8400-e29b-41d4-a716-446655440015
                    name: Other
        '405':
          description: Method not allowed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: METHOD_NOT_ALLOWED
                message: Only GET method is allowed
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getAllJobStatus:
    get:
      tags:
        - Job Management
      summary: Get all available job status types
      description: |
        Returns a list of all available job status types for job workflow management.

        **Use Case:**
        - Used for dropdown/selection in job management and tracking forms
        - Provides standardized list of job status stages
        - No authentication required - public endpoint
        - Three status types: Draft, In Use, Ready

        **Returns:**
        - Array of job status types with id and name
        - Sorted alphabetically by name
      operationId: getAllJobStatus
      responses:
        '200':
          description: Job status types retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                          description: Unique identifier for the job status type
                          example: 550e8400-e29b-41d4-a716-446655440000
                        name:
                          type: string
                          description: Name of the job status type
                          example: Draft
              example:
                data:
                  - id: 550e8400-e29b-41d4-a716-446655440000
                    name: Draft
                  - id: 660e8400-e29b-41d4-a716-446655440001
                    name: In Use
                  - id: 770e8400-e29b-41d4-a716-446655440002
                    name: Ready
        '405':
          description: Method not allowed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: METHOD_NOT_ALLOWED
                message: Only GET method is allowed
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getAllStates:
    get:
      tags:
        - Referral Management
      summary: Get all US states with cities
      description: |
        Returns a list of all 50 US states with their standard abbreviations and major cities.

        **Use Case:**
        - Used for dropdown/selection in address forms
        - Provides standardized list of US states
        - Includes major cities for each state
        - No authentication required - public endpoint

        **Returns:**
        - Array of states with id, name, abbreviation, and cities
        - Each state includes an array of cities with id and name
        - Sorted alphabetically by state name
      operationId: getAllStates
      responses:
        '200':
          description: States and cities retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                          description: State ID
                        name:
                          type: string
                          description: Full state name
                          example: California
                        abbreviation:
                          type: string
                          description: Two-letter state abbreviation
                          example: CA
                        cities:
                          type: array
                          description: Major cities in this state
                          items:
                            type: object
                            properties:
                              id:
                                type: string
                                format: uuid
                                description: City ID
                              name:
                                type: string
                                description: City name
                                example: Los Angeles
              example:
                data:
                  - id: "9ecfafd6-9738-41e2-a2cc-35a84be5e7e1"
                    name: Alabama
                    abbreviation: AL
                    cities:
                      - id: "ba7d6b4f-8052-4e6a-be89-bc5f533e962f"
                        name: Birmingham
                      - id: "96214170-abe2-4ca5-a438-d985a56b7bc3"
                        name: Montgomery
                  - id: "e5af919b-80da-4c29-bab0-900bf44df74e"
                    name: California
                    abbreviation: CA
                    cities:
                      - id: "74fc41aa-4437-48e2-b201-335a71fe5b04"
                        name: Los Angeles
                      - id: "3606499a-a7b4-4474-85df-ab73f713ab92"
                        name: San Francisco
        '405':
          description: Method not allowed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getAddressesFromZone:
    post:
      tags:
        - Address Discovery
      summary: Get addresses from a geographic zone
      description: |
        Discovers addresses within a specified radius or count using OpenStreetMap.

        **Use Case:**
        - Find addresses for door-knocking campaigns
        - Discover residential or commercial buildings in a target area
        - Get addresses without Google Maps API dependency

        **Features:**
        - Supports two modes: radius-based or count-based search
        - Accepts address as lat,lng coordinates or full text address
        - Uses OpenStreetMap Nominatim for geocoding
        - Uses Overpass API for building discovery
        - Filters by building type (ALL, RESIDENTIAL, OTHER)
        - Returns full address details with coordinates
        - Saves zone to location_zones table and returns zone_id

        **Building Type Classifications:**
        - **RESIDENTIAL**: apartments, barracks, bungalow, cabin, detached, annexe, dormitory, farm, ger, hotel, house, houseboat, residential, semidetached_house, static_caravan, stilt_house, terrace, tree_house, trullo
        - **OTHER**: commercial, industrial, office, retail, warehouse, religious buildings (church, mosque, temple, etc.), civic/amenity (hospital, school, museum, etc.), agricultural (barn, greenhouse, stable, etc.), sports (stadium, sports_hall, etc.), storage (shed, hangar, etc.), parking/garages, and more
        - **ALL**: Returns both residential and other building types

        **Address Geocoding:**
        - Uses reverse geocoding to get complete addresses (street, city, state, ZIP)
        - Supports optional Google Maps API key in x-google-api-key header for best results
        - Falls back to OpenStreetMap Nominatim if no Google key provided
        - Google Maps provides faster, more accurate addresses

        **Authentication:**
        - Requires JWT authentication via Authorization header (use "Authorize" button at top)
        - campaign_id is mandatory
      operationId: getAddressesFromZone
      security:
        - SupabaseAuth: []
          BearerAuth: []
      parameters:
        - name: x-google-api-key
          in: header
          required: false
          schema:
            type: string
          description: Optional Google Maps API key for better address geocoding (recommended for accurate PostGrid verification)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - address
                - data
                - campaign_id
              properties:
                address:
                  type: string
                  description: Either "lat,lng" coordinates or full text address to geocode
                  example: "1600 Amphitheatre Parkway, Mountain View, CA 94043"
                data:
                  type: object
                  description: Search parameters - must include either radius OR count
                  properties:
                    radius:
                      type: integer
                      description: Search radius in meters (use for radius mode)
                      example: 1000
                    count:
                      type: integer
                      description: Number of addresses to return (use for count mode)
                      example: 100
                    searchType:
                      type: string
                      enum: [ALL, RESIDENTIAL, OTHER]
                      default: ALL
                      description: Type of buildings to search for (filters results by residential vs other)
                campaign_id:
                  type: string
                  format: uuid
                  description: Campaign ID (required)
            examples:
              radiusMode:
                summary: Radius-based search
                value:
                  address: "37.4224764,-122.0842499"
                  data:
                    radius: 1000
                    searchType: "RESIDENTIAL"
                  campaign_id: "660e8400-e29b-41d4-a716-446655440001"
              countMode:
                summary: Count-based search
                value:
                  address: "1600 Amphitheatre Parkway, Mountain View, CA"
                  data:
                    count: 50
                    searchType: "ALL"
                  campaign_id: "660e8400-e29b-41d4-a716-446655440001"
      responses:
        '200':
          description: Addresses retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: "Found 45 addresses"
                  zone_id:
                    type: string
                    format: uuid
                    description: Zone ID (always returned)
                    example: "123e4567-e89b-12d3-a456-426614174000"
                  center:
                    type: object
                    properties:
                      lat:
                        type: number
                      long:
                        type: number
                      radius:
                        type: integer
                        description: Only present in radius mode
                  mode:
                    type: string
                    enum: [radius, count]
                  searchType:
                    type: string
                    enum: [ALL, RESIDENTIAL, OTHER]
                  metadata:
                    type: object
                    properties:
                      totalBuildingsFound:
                        type: integer
                      addressesReturned:
                        type: integer
                      residentialCount:
                        type: integer
                      otherCount:
                        type: integer
                      processingTimeMs:
                        type: integer
                  addresses:
                    type: array
                    items:
                      type: object
                      properties:
                        lat:
                          type: number
                        long:
                          type: number
                        address:
                          type: string
                        residential:
                          type: boolean
                        building_type:
                          type: string
                        osm_id:
                          type: string
                        propertyType:
                          type: string
                          description: "Type of property (e.g., 'Single Family Home', 'Office Building', 'Warehouse')"
                          example: "Single Family Home"
                        distanceFromCenter:
                          type: integer
                          description: "Distance from search center point in meters"
                          example: 847
                        targeting_zone_name:
                          type: string
                          description: "Human-readable name of the targeting zone based on search address"
                          example: "Mountain View, CA Area"
                        campaigns_used_in:
                          type: array
                          items:
                            type: string
                          description: "List of campaign names that have used this address"
                          example: []
                        zoneType:
                          type: string
                          description: "Type of zone search performed"
                          example: "radius(1.0km)"
                        postcards_sent:
                          type: integer
                          description: "Number of postcards sent to this address"
                          example: 0
                        first_post_card_sent_date:
                          type: string
                          format: date-time
                          nullable: true
                          description: "Date when first postcard was sent to this address"
                          example: null
                        status:
                          type: string
                          enum: ["Valid", "Duplicate", "Opt-out", "UnVerified"]
                          description: "Verification status of the address"
                          example: "UnVerified"
              example:
                status: success
                message: "Found 7 addresses"
                zone_id: "123e4567-e89b-12d3-a456-426614174000"
                center:
                  lat: 37.4224764
                  long: -122.0842499
                  radius: 500
                mode: radius
                searchType: RESIDENTIAL
                metadata:
                  totalBuildingsFound: 7
                  addressesReturned: 7
                  residentialCount: 0
                  otherCount: 7
                  processingTimeMs: 1295
                addresses:
                  - lat: 37.4224816
                    long: -122.085569
                    address: "1600, Amphitheatre Parkway, Mountain View, CA, 94043"
                    residential: false
                    building_type: "commercial"
                    osm_id: "23733659"
                    propertyType: "Office Building"
                    distanceFromCenter: 847
                    targeting_zone_name: "Mountain View, CA Area"
                    campaigns_used_in: []
                    zoneType: "radius(0.5km)"
                    postcards_sent: 0
                    first_post_card_sent_date: null
                    status: "UnVerified"
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /verifyAddresses:
    post:
      tags:
        - Address Discovery
      summary: Verify addresses in a zone using PostGrid
      description: |
        Verifies addresses in a saved zone using PostGrid address verification API.
        Updates the zone in the database with verification results.

        **Use Case:**
        - Validate addresses before sending postcards
        - Filter out undeliverable addresses
        - Get standardized address format

        **Features:**
        - Fetches zone by zone_id from location_zones table
        - Verifies all addresses in the zone using PostGrid API
        - Updates zone in database with verification status for each address
        - Returns all addresses with verified: true/false status (or only verified if showOnlyVerified=true)
        - Saves verified status to database in the zone
        - Only status='verified' is considered verified (not 'corrected')
        - Batch processing up to 1000 addresses
        - Optional filtering to return only verified addresses in response

        **Address Parsing:**
        - Parses address formats: "Street, City, State ZIP" or "Street, City State ZIP"
        - Sends parsed components to PostGrid in format: {address: {line1, city, provinceOrState, postalOrZip, country}}
        - Returns verified address from PostGrid response

        **Authentication:** Requires JWT authentication (use "Authorize" button at top) and PostGrid API key in header
      operationId: verifyAddresses
      security:
        - SupabaseAuth: []
          BearerAuth: []
      parameters:
        - name: x-postgrid-api-key
          in: header
          required: true
          schema:
            type: string
          description: PostGrid API key for address verification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - zone_id
              properties:
                zone_id:
                  type: string
                  format: uuid
                  description: ID of the zone to verify (from getAddressesFromZone response)
                showOnlyVerified:
                  type: boolean
                  default: false
                  description: If true, only return verified addresses in the response. All addresses are still saved to the zone with verification status, but the response will filter to show only verified ones.
            example:
              zone_id: "123e4567-e89b-12d3-a456-426614174000"
              showOnlyVerified: false
      responses:
        '200':
          description: Addresses verified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: "Verified 5 of 7 addresses"
                  center:
                    type: object
                    description: Same center data from the zone
                    properties:
                      lat:
                        type: number
                      long:
                        type: number
                      radius:
                        type: integer
                  mode:
                    type: string
                    enum: [radius, count]
                    description: Same mode from the zone
                  searchType:
                    type: string
                    enum: [ALL, RESIDENTIAL, OTHER]
                    description: Same searchType from the zone
                  metadata:
                    type: object
                    properties:
                      totalBuildingsFound:
                        type: integer
                      addressesReturned:
                        type: integer
                      residentialCount:
                        type: integer
                      otherCount:
                        type: integer
                      verified_count:
                        type: integer
                        description: Number of verified addresses (total)
                      unverified_count:
                        type: integer
                        description: Number of unverified addresses (total)
                      total_addresses:
                        type: integer
                        description: Total number of addresses processed
                      returned_addresses:
                        type: integer
                        description: Number of addresses returned in response (may be filtered if showOnlyVerified=true)
                      showing_only_verified:
                        type: boolean
                        description: Indicates if response is filtered to show only verified addresses
                      processingTimeMs:
                        type: integer
                  addresses:
                    type: array
                    items:
                      type: object
                      properties:
                        lat:
                          type: number
                        long:
                          type: number
                        address:
                          type: string
                        residential:
                          type: boolean
                        building_type:
                          type: string
                        osm_id:
                          type: string
                        verified:
                          type: boolean
                          description: True only if PostGrid status is 'verified' (not 'corrected')
                        verification_details:
                          type: object
                          description: Details from PostGrid verification or error information
                          properties:
                            status:
                              type: string
                              enum: [verified, corrected, undeliverable]
                              description: PostGrid verification status
                            line1:
                              type: string
                              description: Verified street address
                            city:
                              type: string
                              description: Verified city
                            provinceOrState:
                              type: string
                              description: Verified state/province
                            postalOrZip:
                              type: string
                              description: Verified postal/zip code
                            error:
                              type: string
                              description: Error message if verification failed
                        propertyType:
                          type: string
                          description: "Type of property (e.g., 'Single Family Home', 'Office Building', 'Warehouse')"
                          example: "Single Family Home"
                        distanceFromCenter:
                          type: integer
                          description: "Distance from search center point in meters"
                          example: 847
                        targeting_zone_name:
                          type: string
                          description: "Human-readable name of the targeting zone based on search address"
                          example: "Mountain View, CA Area"
                        campaigns_used_in:
                          type: array
                          items:
                            type: string
                          description: "List of campaign names that have used this address"
                          example: []
                        zoneType:
                          type: string
                          description: "Type of zone search performed"
                          example: "radius(1.0km)"
                        postcards_sent:
                          type: integer
                          description: "Number of postcards sent to this address"
                          example: 0
                        first_post_card_sent_date:
                          type: string
                          format: date-time
                          nullable: true
                          description: "Date when first postcard was sent to this address"
                          example: null
                        status:
                          type: string
                          enum: ["Valid", "Duplicate", "Opt-out", "UnVerified"]
                          description: "Verification status of the address"
                          example: "UnVerified"
              example:
                status: success
                message: "Verified 5 of 7 addresses"
                center:
                  lat: 37.4224764
                  long: -122.0842499
                  radius: 500
                mode: radius
                searchType: RESIDENTIAL
                metadata:
                  totalBuildingsFound: 7
                  addressesReturned: 7
                  residentialCount: 7
                  otherCount: 0
                  verified_count: 5
                  unverified_count: 2
                  processingTimeMs: 5234
                addresses:
                  - lat: 37.4225
                    long: -122.0843
                    address: "1600 Amphitheatre Parkway, Mountain View, CA 94043"
                    residential: true
                    building_type: "house"
                    osm_id: "way/123456789"
                    verified: true
                    verification_details:
                      status: verified
                      line1: "1600 Amphitheatre Pkwy"
                      city: "Mountain View"
                      provinceOrState: "CA"
                      postalOrZip: "94043"
                    propertyType: "Single Family Home"
                    distanceFromCenter: 425
                    targeting_zone_name: "Mountain View, CA Area"
                    campaigns_used_in: []
                    zoneType: "radius(0.5km)"
                    postcards_sent: 0
                    first_post_card_sent_date: null
                    status: "Valid"
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getAddressZoneById:
    post:
      tags:
        - Address Zones
      summary: Get address zone by ID
      description: |
        Retrieves a specific location zone by ID.

        **Business Rules:**
        - Organization-based (user must be in same organization as zone)
        - Returns complete zone data including all addresses
      operationId: getAddressZoneById
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: string
                  format: uuid
                  description: Zone ID
            example:
              id: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '200':
          description: Zone retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/LocationZone'
        '401':
          description: Unauthorized
        '403':
          description: User not in organization
        '404':
          description: Zone not found
        '500':
          description: Internal server error

  /getAllAddressZones:
    get:
      tags:
        - Address Zones
      summary: Get all address zones
      description: |
        Retrieves all location zones for the user's organization.

        **Business Rules:**
        - Organization-based (returns only zones from user's organization)
        - Ordered by most recent first
        - Includes all zone data and addresses
      operationId: getAllAddressZones
      security:
        - SupabaseAuth: []
          BearerAuth: []
      responses:
        '200':
          description: Zones retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/LocationZone'
                  count:
                    type: integer
        '401':
          description: Unauthorized
        '403':
          description: User not in organization
        '500':
          description: Internal server error

  /updateAddressZoneById:
    patch:
      tags:
        - Address Zones
      summary: Update address zone by ID
      description: |
        Updates a specific location zone by ID.

        **Business Rules:**
        - Organization-based (user must be in same organization as zone)
        - Can update: center, mode, search_type, metadata, addresses
        - Cannot update: id, organization_id, campaign_id, created_at
        - Updates updated_at timestamp automatically
      operationId: updateAddressZoneById
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: string
                  format: uuid
                  description: Zone ID
                center:
                  type: object
                  description: Center coordinates
                mode:
                  type: string
                  enum: [radius, count]
                search_type:
                  type: string
                  enum: [ALL, RESIDENTIAL, OTHER]
                metadata:
                  type: object
                  description: Zone metadata
                addresses:
                  type: array
                  description: Array of addresses
            example:
              id: "123e4567-e89b-12d3-a456-426614174000"
              search_type: "RESIDENTIAL"
              metadata:
                note: "Updated zone"
      responses:
        '200':
          description: Zone updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/LocationZone'
        '400':
          description: Invalid input or attempting to update protected fields
        '401':
          description: Unauthorized
        '403':
          description: User not in organization
        '404':
          description: Zone not found
        '500':
          description: Internal server error

  /deleteAddressZone:
    delete:
      tags:
        - Address Zones
      summary: Delete address zone
      description: |
        Deletes a specific location zone by ID.

        **Business Rules:**
        - Organization-based (user must be in same organization as zone)
        - Cascade behavior: If campaigns reference this zone, zone_id will be set to NULL
      operationId: deleteAddressZone
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: string
                  format: uuid
                  description: Zone ID
            example:
              id: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '200':
          description: Zone deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                      deleted:
                        type: boolean
        '401':
          description: Unauthorized
        '403':
          description: User not in organization
        '404':
          description: Zone not found
        '500':
          description: Internal server error

  /getAllAddresses:
    get:
      tags:
        - Address Management
      summary: Get all addresses from organization zones
      description: |
        Retrieves all addresses from all location zones in the user's organization with optional filtering.

        **Business Rules:**
        - Returns addresses from all zones in the organization
        - Optional filtering to show only non-Valid addresses (exclusions)
        - Automatic deduplication based on lat/lng coordinates
        - Includes zone metadata for each address

        **Request Methods:**
        - GET: Returns all addresses (showOnlyExclusions = false)
        - POST: Supports filtering with request body

        **Filtering Logic:**
        - showOnlyExclusions = false (default): Returns all addresses
        - showOnlyExclusions = true: Returns only UnVerified, Duplicate, and Opt-out addresses (excludes Valid)
      operationId: getAllAddressesGet
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Addresses retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Found 150 unique addresses from 3 zones"
                  metadata:
                    type: object
                    properties:
                      total_zones:
                        type: integer
                        description: "Number of zones in organization"
                        example: 3
                      total_addresses_before_dedup:
                        type: integer
                        description: "Total addresses before deduplication"
                        example: 152
                      total_addresses_after_dedup:
                        type: integer
                        description: "Total unique addresses after deduplication"
                        example: 150
                      addresses_returned:
                        type: integer
                        description: "Number of addresses returned after filtering"
                        example: 150
                      showOnlyExclusions:
                        type: boolean
                        description: "Whether exclusion filter was applied"
                        example: false
                      status_breakdown:
                        type: object
                        properties:
                          Valid:
                            type: integer
                            example: 120
                          UnVerified:
                            type: integer
                            example: 25
                          Duplicate:
                            type: integer
                            example: 3
                          Opt-out:
                            type: integer
                            example: 2
                      processingTimeMs:
                        type: integer
                        description: "Processing time in milliseconds"
                        example: 150
                  addresses:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/AddressObject'
                        - type: object
                          properties:
                            zone_id:
                              type: string
                              format: uuid
                              description: "ID of the zone this address belongs to"
                              example: "c9abd41e-56a2-448e-942c-a0b37f796972"
                            zone_name:
                              type: string
                              description: "Name of the zone this address belongs to"
                              example: "Mountain View Zone"
                            campaign_id:
                              type: string
                              format: uuid
                              nullable: true
                              description: "Campaign ID associated with the zone"
                              example: "a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6"
              examples:
                allAddresses:
                  summary: Get all addresses from organization
                  value:
                    status: "success"
                    message: "Found 150 unique addresses from 3 zones"
                    metadata:
                      total_zones: 3
                      total_addresses_before_dedup: 152
                      total_addresses_after_dedup: 150
                      addresses_returned: 150
                      showOnlyExclusions: false
                      status_breakdown:
                        Valid: 120
                        UnVerified: 25
                        Duplicate: 3
                        Opt-out: 2
                      processingTimeMs: 150
                    addresses: []
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: User not in organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      tags:
        - Address Management
      summary: Get all addresses from organization zones with filtering
      description: |
        Retrieves all addresses from all location zones in the user's organization with optional filtering.

        **Business Rules:**
        - Returns addresses from all zones in the organization
        - Optional filtering to show only non-Valid addresses (exclusions)
        - Automatic deduplication based on lat/lng coordinates
        - Includes zone metadata for each address

        **Request Methods:**
        - GET: Returns all addresses (showOnlyExclusions = false)
        - POST: Supports filtering with request body

        **Filtering Logic:**
        - showOnlyExclusions = false (default): Returns all addresses
        - showOnlyExclusions = true: Returns only UnVerified, Duplicate, and Opt-out addresses (excludes Valid)
      operationId: getAllAddressesPost
      security:
        - BearerAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                showOnlyExclusions:
                  type: boolean
                  default: false
                  description: "If true, returns only addresses with status other than 'Valid'"
                  example: true
            example:
              showOnlyExclusions: true
      responses:
        '200':
          description: Addresses retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Found 30 addresses with non-Valid status (30 total exclusions)"
                  metadata:
                    type: object
                    properties:
                      total_zones:
                        type: integer
                        description: "Number of zones in organization"
                        example: 3
                      total_addresses_before_dedup:
                        type: integer
                        description: "Total addresses before deduplication"
                        example: 152
                      total_addresses_after_dedup:
                        type: integer
                        description: "Total unique addresses after deduplication"
                        example: 150
                      addresses_returned:
                        type: integer
                        description: "Number of addresses returned after filtering"
                        example: 30
                      showOnlyExclusions:
                        type: boolean
                        description: "Whether exclusion filter was applied"
                        example: true
                      status_breakdown:
                        type: object
                        properties:
                          Valid:
                            type: integer
                            example: 120
                          UnVerified:
                            type: integer
                            example: 25
                          Duplicate:
                            type: integer
                            example: 3
                          Opt-out:
                            type: integer
                            example: 2
                      processingTimeMs:
                        type: integer
                        description: "Processing time in milliseconds"
                        example: 120
                  addresses:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/AddressObject'
                        - type: object
                          properties:
                            zone_id:
                              type: string
                              format: uuid
                              description: "ID of the zone this address belongs to"
                              example: "c9abd41e-56a2-448e-942c-a0b37f796972"
                            zone_name:
                              type: string
                              description: "Name of the zone this address belongs to"
                              example: "Mountain View Zone"
                            campaign_id:
                              type: string
                              format: uuid
                              nullable: true
                              description: "Campaign ID associated with the zone"
                              example: "a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6"
              examples:
                exclusionsOnly:
                  summary: Get only non-Valid addresses (exclusions)
                  value:
                    status: "success"
                    message: "Found 30 addresses with non-Valid status (30 total exclusions)"
                    metadata:
                      total_zones: 3
                      total_addresses_before_dedup: 152
                      total_addresses_after_dedup: 150
                      addresses_returned: 30
                      showOnlyExclusions: true
                      status_breakdown:
                        Valid: 120
                        UnVerified: 25
                        Duplicate: 3
                        Opt-out: 2
                      processingTimeMs: 120
                    addresses: []
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: User not in organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /excludeAddress:
    post:
      tags:
        - Address Management
      summary: Exclude (opt-out) an address across all zones
      description: |
        Opts out an address across all zones accessible to the user by changing its status to 'Opt-out'.

        **Business Rules:**
        - Takes a complete address object in request body
        - Searches for the address across all zones in user's organization
        - Changes status to 'Opt-out' wherever the address is found
        - Matches addresses based on lat/lng coordinates (with tolerance)
        - Returns list of zones where address was updated
        - Supports matching addresses across multiple zones simultaneously

        **Matching Logic:**
        - Uses coordinate matching with tolerance (0.000001 degrees)
        - Approximately 0.1 meter precision for address matching
        - Updates all matching addresses found in any zone

        **Use Cases:**
        - User opts out from receiving marketing materials
        - Compliance with do-not-contact requests
        - Global exclusion management
        - Address blacklisting across campaigns
      operationId: excludeAddress
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - address
              properties:
                address:
                  allOf:
                    - $ref: '#/components/schemas/AddressObject'
                    - type: object
                      description: "Complete address object to be excluded"
            example:
              address:
                lat: 37.4176671
                long: -122.0928876
                address: "901, North Rengstorff Avenue"
                residential: true
                building_type: "residential"
                osm_id: "166790593"
                propertyType: "Residential Building"
                distanceFromCenter: 933
                targeting_zone_name: "Zone at 37.4225, -122.0842"
                campaigns_used_in: []
                zoneType: "radius(1.0km)"
                postcards_sent: 0
                first_post_card_sent_date: null
                status: "UnVerified"
                zone_id: "1b503442-f07e-4aaa-800e-b151d0a1e37d"
                zone_name: "Zone at 37.4225, -122.0842"
                campaign_id: "1c650d6f-a29c-4667-9f17-5709765ba34f"
      responses:
        '200':
          description: Address successfully excluded
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Address successfully excluded in 1 zone(s)"
                  address:
                    type: object
                    properties:
                      lat:
                        type: number
                        format: double
                        example: 37.4176671
                      long:
                        type: number
                        format: double
                        example: -122.0928876
                      address:
                        type: string
                        example: "901, North Rengstorff Avenue"
                  zonesSearched:
                    type: integer
                    description: "Total number of zones searched"
                    example: 1
                  zonesUpdated:
                    type: array
                    items:
                      type: object
                      properties:
                        zone_id:
                          type: string
                          format: uuid
                          example: "1b503442-f07e-4aaa-800e-b151d0a1e37d"
                        zone_name:
                          type: string
                          example: "Zone at 37.4225, -122.0842"
                        campaign_id:
                          type: string
                          format: uuid
                          nullable: true
                          example: "1c650d6f-a29c-4667-9f17-5709765ba34f"
                        addresses_updated:
                          type: integer
                          description: "Number of addresses updated in this zone"
                          example: 1
                  addressesUpdated:
                    type: integer
                    description: "Total number of address instances updated across all zones"
                    example: 1
                  processingTimeMs:
                    type: integer
                    description: "Processing time in milliseconds"
                    example: 817
              examples:
                singleZoneUpdate:
                  summary: Address found and excluded in one zone
                  value:
                    status: "success"
                    message: "Address successfully excluded in 1 zone(s)"
                    address:
                      lat: 37.4176671
                      long: -122.0928876
                      address: "901, North Rengstorff Avenue"
                    zonesSearched: 1
                    zonesUpdated:
                      - zone_id: "1b503442-f07e-4aaa-800e-b151d0a1e37d"
                        zone_name: "Zone at 37.4225, -122.0842"
                        campaign_id: "1c650d6f-a29c-4667-9f17-5709765ba34f"
                        addresses_updated: 1
                    addressesUpdated: 1
                    processingTimeMs: 817
                multipleZonesUpdate:
                  summary: Address found and excluded in multiple zones
                  value:
                    status: "success"
                    message: "Address successfully excluded in 3 zone(s)"
                    address:
                      lat: 37.4176671
                      long: -122.0928876
                      address: "901, North Rengstorff Avenue"
                    zonesSearched: 5
                    zonesUpdated:
                      - zone_id: "1b503442-f07e-4aaa-800e-b151d0a1e37d"
                        zone_name: "Zone A"
                        campaign_id: "1c650d6f-a29c-4667-9f17-5709765ba34f"
                        addresses_updated: 1
                      - zone_id: "2c513552-g18f-5bbb-911f-c262e1b2f48e"
                        zone_name: "Zone B"
                        campaign_id: "2d761e7g-b3ad-5778-a28g-6810876cb56g"
                        addresses_updated: 1
                      - zone_id: "3d624663-h29g-6ccc-a22g-d373f2c3g59f"
                        zone_name: "Zone C"
                        campaign_id: null
                        addresses_updated: 1
                    addressesUpdated: 3
                    processingTimeMs: 1245
                addressNotFound:
                  summary: Address not found in any zone
                  value:
                    status: "success"
                    message: "Address not found in any accessible zones"
                    zonesSearched: 5
                    zonesUpdated: []
                    addressesUpdated: 0
                    processingTimeMs: 320
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingAddress:
                  summary: Missing address in request body
                  value:
                    error: "INVALID_INPUT"
                    message: "Missing 'address' object in request body"
                invalidCoordinates:
                  summary: Invalid coordinates
                  value:
                    error: "INVALID_INPUT"
                    message: "Address must have valid 'lat' and 'long' coordinates"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: User not in organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '405':
          description: Method not allowed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "METHOD_NOT_ALLOWED"
                message: "Only POST method is allowed"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /createReferral:
    post:
      tags:
        - Referral Management
      summary: Create a new referral
      description: |
        Creates a new referral with Draft status. All fields are optional - if no data is provided, creates an empty referral with default values.

        **Business Rules:**
        - Status is always set to "Draft" on creation
        - All fields have default empty values
        - Returns the complete created referral object
      operationId: createReferral
      security:
        - BearerAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              description: All fields are optional
      responses:
        '201':
          description: Referral created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Referral created successfully
                  data:
                    $ref: '#/components/schemas/Referral'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /createNewTemplate:
    post:
      tags:
        - Template Management
      summary: Create a new PostGrid template
      description: |
        Creates a template in PostGrid and saves it to the database.

        **Business Rules:**
        - Creates template using PostGrid API
        - Saves template metadata to database
        - Template is organization-scoped
        - Tracks creator via createdBy field
        - Initializes empty campaigns_used array

        **Required Fields:**
        - postgridApiKey: PostGrid API key for authentication
        - description: Template description
        - html: HTML content for the template
        - templateType: Front or Back
        - postcardSize: 4x6, 6x9, or 6x11
      operationId: createNewTemplate
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - postgridApiKey
                - description
                - html
                - templateType
                - postcardSize
              properties:
                postgridApiKey:
                  type: string
                  description: "PostGrid API key"
                  example: "live_sk_..."
                description:
                  type: string
                  description: "Template description"
                  example: "Summer Campaign Front Template"
                html:
                  type: string
                  description: "HTML content for the template"
                  example: "<b>Hello</b> {{to.firstName}}!"
                templateType:
                  type: string
                  enum: ["Front", "Back"]
                  description: "Template type: Front or Back of postcard"
                  example: "Front"
                postcardSize:
                  type: string
                  enum: ["4x6", "6x9", "6x11"]
                  description: "Postcard size"
                  example: "4x6"
      responses:
        '201':
          description: Template created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Template created successfully"
                  template:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                        example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                      postgrid_template_id:
                        type: string
                        example: "template_tBnVEzz878mXLbHQaz86j8"
                      description:
                        type: string
                        example: "Summer Campaign Front Template"
                      html:
                        type: string
                        example: "<b>Hello</b> {{to.firstName}}!"
                      templateType:
                        type: string
                        enum: ["Front", "Back"]
                        example: "Front"
                      postcardSize:
                        type: string
                        enum: ["4x6", "6x9", "6x11"]
                        example: "4x6"
                      campaigns_used:
                        type: array
                        items:
                          type: string
                        example: []
                      createdBy:
                        $ref: '#/components/schemas/CreatedByInfo'
                      live:
                        type: boolean
                        example: false
                      deleted:
                        type: boolean
                        example: false
                      created_at:
                        type: string
                        format: date-time
                        example: "2025-02-02T10:00:00.000Z"
                      updated_at:
                        type: string
                        format: date-time
                        example: "2025-02-02T10:00:00.000Z"
                  processingTimeMs:
                    type: integer
                    example: 1523
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: User not in organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: PostGrid API or database error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getAllTemplates:
    get:
      tags:
        - Template Management
      summary: Get all templates for organization
      description: |
        Returns all templates belonging to the user's organization.

        **Business Rules:**
        - Returns only templates from user's organization
        - Excludes deleted templates by default
        - Supports filtering by templateType and postcardSize
        - Returns templates ordered by created_at (newest first)
      operationId: getAllTemplates
      security:
        - BearerAuth: []
      parameters:
        - name: includeDeleted
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: "Include deleted templates"
        - name: templateType
          in: query
          required: false
          schema:
            type: string
            enum: ["Front", "Back"]
          description: "Filter by template type"
        - name: postcardSize
          in: query
          required: false
          schema:
            type: string
            enum: ["4x6", "6x9", "6x11"]
          description: "Filter by postcard size"
      responses:
        '200':
          description: Templates retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Found 5 template(s)"
                  metadata:
                    type: object
                    properties:
                      total_templates:
                        type: integer
                        example: 5
                      filters_applied:
                        type: object
                        properties:
                          includeDeleted:
                            type: boolean
                            example: false
                          templateType:
                            type: string
                            nullable: true
                            example: null
                          postcardSize:
                            type: string
                            nullable: true
                            example: null
                      processingTimeMs:
                        type: integer
                        example: 245
                  templates:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        postgrid_template_id:
                          type: string
                        description:
                          type: string
                        html:
                          type: string
                        templateType:
                          type: string
                          enum: ["Front", "Back"]
                        postcardSize:
                          type: string
                          enum: ["4x6", "6x9", "6x11"]
                        campaigns_used:
                          type: array
                          items:
                            type: string
                        createdBy:
                          $ref: '#/components/schemas/CreatedByInfo'
                        live:
                          type: boolean
                        deleted:
                          type: boolean
                        created_at:
                          type: string
                          format: date-time
                        updated_at:
                          type: string
                          format: date-time
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: User not in organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Database error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getTemplateById:
    post:
      tags:
        - Template Management
      summary: Get a template by ID
      description: |
        Retrieves a single template by either database UUID or PostGrid template ID.

        **Business Rules:**
        - Accepts either database UUID or PostGrid template ID
        - Template must belong to user's organization
        - Returns error if template is deleted
        - User must be authenticated

        **ID Detection:**
        - UUID format (8-4-4-4-12): Treated as database ID
        - Any other format: Treated as PostGrid template ID
      operationId: getTemplateById
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - templateId
              properties:
                templateId:
                  type: string
                  description: "Template ID (database UUID or PostGrid template ID)"
                  example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
            examples:
              databaseId:
                summary: Query by database UUID
                value:
                  templateId: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
              postgridId:
                summary: Query by PostGrid template ID
                value:
                  templateId: "template_tBnVEzz878mXLbHQaz86j8"
      responses:
        '200':
          description: Template retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Template retrieved successfully"
                  template:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      postgrid_template_id:
                        type: string
                      description:
                        type: string
                      html:
                        type: string
                      templateType:
                        type: string
                        enum: ["Front", "Back"]
                      postcardSize:
                        type: string
                        enum: ["4x6", "6x9", "6x11"]
                      campaigns_used:
                        type: array
                        items:
                          type: string
                      createdBy:
                        $ref: '#/components/schemas/CreatedByInfo'
                      live:
                        type: boolean
                      deleted:
                        type: boolean
                      created_at:
                        type: string
                        format: date-time
                      updated_at:
                        type: string
                        format: date-time
                  processingTimeMs:
                    type: integer
                    example: 145
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: User not in organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '410':
          description: Template has been deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "TEMPLATE_DELETED"
                message: "This template has been deleted"
        '500':
          description: Database error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /updateTemplate:
    post:
      tags:
        - Template Management
      summary: Update a template
      description: |
        Updates a template in both PostGrid and the database.

        **Business Rules:**
        - Template ID can be either database UUID or PostGrid template ID
        - Template must belong to user's organization
        - Updates PostGrid template first, then updates database
        - Cannot update deleted templates
        - Supports partial updates (provide only fields to update)

        **Template ID Flexibility:**
        - Accepts either database UUID or PostGrid template ID
        - Automatically detects ID type and looks up template

        **Returns:** Updated template information
      operationId: updateTemplate
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - postgridApiKey
                - templateId
              properties:
                postgridApiKey:
                  type: string
                  description: "PostGrid API key"
                  example: "live_sk_..."
                templateId:
                  type: string
                  description: "Template ID (database UUID or PostGrid template ID)"
                  example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                html:
                  type: string
                  description: "Updated HTML content (optional)"
                  example: "<b>Hello</b> updated world!"
                description:
                  type: string
                  description: "Updated description (optional)"
                  example: "Updated Summer Campaign Front Template"
            example:
              postgridApiKey: "live_sk_..."
              templateId: "template_tBnVEzz878mXLbHQaz86j8"
              html: "<b>Hello</b> updated world!"
              description: "Updated template description"
      responses:
        '200':
          description: Template updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Template updated successfully"
                  template:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      postgrid_template_id:
                        type: string
                      description:
                        type: string
                      html:
                        type: string
                      templateType:
                        type: string
                        enum: ["Front", "Back"]
                      postcardSize:
                        type: string
                        enum: ["4x6", "6x9", "6x11"]
                      campaigns_used:
                        type: array
                        items:
                          type: string
                      createdBy:
                        $ref: '#/components/schemas/CreatedByInfo'
                      live:
                        type: boolean
                      deleted:
                        type: boolean
                      created_at:
                        type: string
                        format: date-time
                      updated_at:
                        type: string
                        format: date-time
                  processingTimeMs:
                    type: integer
                    example: 892
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingField:
                  value:
                    error: "INVALID_INPUT"
                    message: "At least one field (html or description) must be provided for update"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: User not in organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                notFound:
                  value:
                    error: "TEMPLATE_NOT_FOUND"
                    message: "Template not found or doesn't belong to your organization"
        '410':
          description: Template is deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                deleted:
                  value:
                    error: "TEMPLATE_DELETED"
                    message: "Cannot update a deleted template"
        '500':
          description: PostGrid API or database error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /deleteTemplate:
    post:
      tags:
        - Template Management
      summary: Delete a template
      description: |
        Deletes a template from both PostGrid and the database.

        **Business Rules:**
        - Template must belong to user's organization
        - Deletes template from PostGrid first
        - Then marks template as deleted in database (soft delete)
        - Cannot delete already deleted templates
      operationId: deleteTemplate
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - templateId
                - postgridApiKey
              properties:
                templateId:
                  type: string
                  format: uuid
                  description: "Template ID to delete"
                  example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                postgridApiKey:
                  type: string
                  description: "PostGrid API key"
                  example: "live_sk_..."
      responses:
        '200':
          description: Template deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Template deleted successfully"
                  template:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      postgrid_template_id:
                        type: string
                      description:
                        type: string
                  processingTimeMs:
                    type: integer
                    example: 892
        '400':
          description: Invalid input or template already deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: User not in organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: PostGrid API or database error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /createPostCardFromTemplate:
    post:
      tags:
        - Template Management
      summary: Create a postcard from templates
      description: |
        Creates a postcard using PostGrid API with specified templates.

        **Business Rules:**
        - Requires PostGrid API key in request body
        - Accepts both database UUID and PostGrid template IDs for frontTemplate and backTemplate
        - Templates must belong to user's organization
        - Cannot use deleted templates
        - All PostGrid postcard creation parameters are supported

        **Template ID Flexibility:**
        - frontTemplate and backTemplate accept either:
          - Database UUID (e.g., "a7b3c4d5-e6f7-8901-2345-6789abcdef01")
          - PostGrid template ID (e.g., "template_abc123xyz")

        **Returns:** Complete PostGrid postcard response
      operationId: createPostCardFromTemplate
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - postgridApiKey
                - to
                - from
                - size
                - frontTemplate
                - backTemplate
              properties:
                postgridApiKey:
                  type: string
                  description: "PostGrid API key"
                  example: "test_sk_7oVoDY45m5aPpjKmMZJxz3"
                to:
                  type: object
                  description: "Recipient address"
                  required:
                    - firstName
                    - lastName
                    - addressLine1
                    - city
                    - provinceOrState
                    - postalOrZip
                    - countryCode
                  properties:
                    firstName:
                      type: string
                      example: "John"
                    lastName:
                      type: string
                      example: "Smith"
                    addressLine1:
                      type: string
                      example: "123 Main Street"
                    addressLine2:
                      type: string
                    city:
                      type: string
                      example: "San Francisco"
                    provinceOrState:
                      type: string
                      example: "CA"
                    postalOrZip:
                      type: string
                      example: "94105"
                    countryCode:
                      type: string
                      example: "US"
                from:
                  type: object
                  description: "Sender address"
                  required:
                    - addressLine1
                    - city
                    - provinceOrState
                    - postalOrZip
                    - countryCode
                  properties:
                    firstName:
                      type: string
                    lastName:
                      type: string
                    companyName:
                      type: string
                      example: "ABC Home Services"
                    addressLine1:
                      type: string
                      example: "456 Business Ave"
                    addressLine2:
                      type: string
                    city:
                      type: string
                      example: "San Francisco"
                    provinceOrState:
                      type: string
                      example: "CA"
                    postalOrZip:
                      type: string
                      example: "94107"
                    countryCode:
                      type: string
                      example: "US"
                size:
                  type: string
                  description: "Postcard size"
                  example: "6x4"
                  enum:
                    - "6x4"
                    - "6x9"
                    - "6x11"
                frontTemplate:
                  type: string
                  description: "Front template ID (database UUID or PostGrid template ID)"
                  example: "a7b3c4d5-e6f7-8901-2345-6789abcdef01"
                backTemplate:
                  type: string
                  description: "Back template ID (database UUID or PostGrid template ID)"
                  example: "template_phXZr8fWFejSVWP3o5WEWh"
                description:
                  type: string
                  description: "Optional description for the postcard"
                  example: "Spring Promo Postcard"
                mergeVariables:
                  type: object
                  description: "Variables to merge into the template"
                  additionalProperties: true
                  example:
                    offer_headline: "Special Spring Discount!"
                    offer_description: "Get 20% off all services this month"
                    cta_text: "Call Now to Redeem"
                    disclaimer_text: "Offer valid for new customers only"
                    business_name: "ABC Home Services"
                    phone: "+1-555-123-4567"
                    website: "https://abchome.com"
                    qr_url: "https://abchome.com/spring-promo"
                    before_image_id: "https://example.com/before.jpg"
                    after_image_id: "https://example.com/after.jpg"
            example:
              postgridApiKey: "test_sk_7oVoDY45m5aPpjKmMZJxz3"
              to:
                firstName: "John"
                lastName: "Smith"
                addressLine1: "123 Main Street"
                city: "San Francisco"
                provinceOrState: "CA"
                postalOrZip: "94105"
                countryCode: "US"
              from:
                companyName: "ABC Home Services"
                addressLine1: "456 Business Ave"
                city: "San Francisco"
                provinceOrState: "CA"
                postalOrZip: "94107"
                countryCode: "US"
              size: "6x4"
              frontTemplate: "a7b3c4d5-e6f7-8901-2345-6789abcdef01"
              backTemplate: "template_phXZr8fWFejSVWP3o5WEWh"
              description: "Spring Promo Postcard"
              mergeVariables:
                offer_headline: "Special Spring Discount!"
                offer_description: "Get 20% off all services this month"
                cta_text: "Call Now to Redeem"
                disclaimer_text: "Offer valid for new customers only"
                business_name: "ABC Home Services"
                phone: "+1-555-123-4567"
                website: "https://abchome.com"
                qr_url: "https://abchome.com/spring-promo"
                before_image_id: "https://example.com/before.jpg"
                after_image_id: "https://example.com/after.jpg"
      responses:
        '201':
          description: Postcard created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Postcard created successfully"
                  postcard:
                    type: object
                    description: "Complete PostGrid postcard response object"
                  processingTimeMs:
                    type: integer
                    example: 1523
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingField:
                  value:
                    error: "INVALID_INPUT"
                    message: "postgridApiKey is required and must be a string"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: User not in organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                templateNotFound:
                  value:
                    error: "TEMPLATE_NOT_FOUND"
                    message: "Front template not found or doesn't belong to your organization"
        '410':
          description: Template has been deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                templateDeleted:
                  value:
                    error: "TEMPLATE_DELETED"
                    message: "Front template has been deleted"
        '500':
          description: PostGrid API error or internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                postgridError:
                  value:
                    error: "POSTGRID_API_ERROR"
                    message: "PostGrid API returned error: 400 - Invalid template ID"

  /getPostCardById:
    post:
      tags:
        - Template Management
      summary: Get postcard by ID
      description: |
        Retrieves a postcard from PostGrid API by its ID.

        **Business Rules:**
        - Requires PostGrid API key and postcard ID
        - Returns complete postcard details from PostGrid
        - Organization-scoped (user must be in organization)

        **Returns:** Complete PostGrid postcard response
      operationId: getPostCardById
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - postgridApiKey
                - postcardId
              properties:
                postgridApiKey:
                  type: string
                  description: "PostGrid API key"
                  example: "test_sk_7oVoDY45m5aPpjKmMZJxz3"
                postcardId:
                  type: string
                  description: "PostGrid postcard ID"
                  example: "postcard_dfHxSciyRyyAZkRsuWSrNn"
            example:
              postgridApiKey: "test_sk_7oVoDY45m5aPpjKmMZJxz3"
              postcardId: "postcard_dfHxSciyRyyAZkRsuWSrNn"
      responses:
        '200':
          description: Postcard retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Postcard retrieved successfully"
                  postcard:
                    type: object
                    description: "Complete PostGrid postcard response object"
                    properties:
                      id:
                        type: string
                        example: "postcard_dfHxSciyRyyAZkRsuWSrNn"
                      object:
                        type: string
                        example: "postcard"
                      live:
                        type: boolean
                        example: false
                      to:
                        type: object
                        description: "Recipient address"
                      from:
                        type: object
                        description: "Sender address"
                      size:
                        type: string
                        example: "6x4"
                      frontTemplate:
                        type: string
                        example: "template_ePSnE9wew6vFzghb1V4awo"
                      backTemplate:
                        type: string
                        example: "template_phXZr8fWFejSVWP3o5WEWh"
                      description:
                        type: string
                      url:
                        type: string
                      createdAt:
                        type: string
                        format: date-time
                      updatedAt:
                        type: string
                        format: date-time
                  processingTimeMs:
                    type: integer
                    example: 245
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingField:
                  value:
                    error: "INVALID_INPUT"
                    message: "postcardId is required and must be a string"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: User not in organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Postcard not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                notFound:
                  value:
                    error: "POSTGRID_API_ERROR"
                    message: "PostGrid API returned error: 404 - Postcard not found"
        '500':
          description: PostGrid API error or internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                postgridError:
                  value:
                    error: "POSTGRID_API_ERROR"
                    message: "Failed to connect to PostGrid API"

  /getTemplateHistory:
    post:
      tags:
        - Template Management
      summary: Get template history
      description: |
        Retrieves the complete history log for a specific template.

        **Business Rules:**
        - Accepts both database UUID and PostGrid template ID
        - Returns all logged actions for the template (creation, updates, deletions)
        - Ordered by most recent first
        - Includes user information for each action
        - Organization-scoped (user must be in organization)

        **Returns:** Complete template history with all actions
      operationId: getTemplateHistory
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: string
                  description: "Template ID (database UUID or PostGrid template ID)"
                  example: "550e8400-e29b-41d4-a716-446655440000"
            example:
              id: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        '200':
          description: Template history retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Template history retrieved successfully"
                  data:
                    type: object
                    properties:
                      template_id:
                        type: string
                        format: uuid
                      history:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                            template_id:
                              type: string
                              format: uuid
                            user_id:
                              type: string
                              format: uuid
                            user_name:
                              type: string
                              example: "John Doe"
                            action:
                              type: string
                              example: "created template (Front, 4x6)"
                            created_at:
                              type: string
                              format: date-time
                      count:
                        type: integer
                        example: 5
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingId:
                  value:
                    error: "INVALID_INPUT"
                    message: "Template ID is required"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: User not in organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                notFound:
                  value:
                    error: "TEMPLATE_NOT_FOUND"
                    message: "Template not found in your organization"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getReferralById:
    post:
      tags:
        - Referral Management
      summary: Get referral by ID
      description: |
        Retrieves a specific referral by its ID.

        **Required:**
        - id: UUID of the referral

        **Returns:**
        - Complete referral information including image_url (first image from gallery, empty string if no images)
      operationId: getReferralById
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: string
                  format: uuid
                  description: Referral ID
                  example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Referral retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/Referral'
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Referral not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getAllReferrals:
    get:
      tags:
        - Referral Management
      summary: Get all referrals with pagination
      description: |
        Returns a paginated list of referrals from the database, ordered by creation date (newest first).

        **Pagination:**
        - Use `page` query parameter to specify page number (default: 1)
        - Use `limit` query parameter to specify results per page (default: 10, max: 100)
        - Returns pagination metadata including total count and page information

        **Examples:**
        - `/getAllReferrals` - Returns first 10 referrals
        - `/getAllReferrals?page=2&limit=20` - Returns 20 referrals on page 2
        - `/getAllReferrals?limit=50` - Returns first 50 referrals

        **Returns:**
        - Array of complete referral objects with image_url (first image from gallery, empty string if no images)
        - Pagination metadata
      operationId: getAllReferrals
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          description: "Page number (default: 1, min: 1)"
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
        - name: limit
          in: query
          description: "Number of results per page (default: 10, min: 1, max: 100)"
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
            example: 10
      responses:
        '200':
          description: Referrals retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Referral'
                  pagination:
                    type: object
                    properties:
                      page:
                        type: integer
                        example: 1
                        description: Current page number
                      limit:
                        type: integer
                        example: 10
                        description: Results per page
                      total_count:
                        type: integer
                        example: 47
                        description: Total number of referrals
                      total_pages:
                        type: integer
                        example: 5
                        description: Total number of pages
                      has_next_page:
                        type: boolean
                        example: true
                        description: Whether there is a next page
                      has_previous_page:
                        type: boolean
                        example: false
                        description: Whether there is a previous page
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /updateReferralById:
    patch:
      tags:
        - Referral Management
      summary: Update referral by ID
      description: |
        Updates a specific referral by its ID. Can update any field except the ID itself.

        **Validation:**
        - address must be a JSON object
        - job_details must be a JSON object
        - job_type must be a JSON object with id and name
        - status can be passed as string ("Draft", "In Use", "Ready") or JSON object

        **Supported Fields:**
        - name, phone, email (home_owner_info)
        - address, street, city, state, zip (address fields)
        - job_type, value, currency, referral_percentage, notes (job_details)
        - status

        **Returns:**
        - Updated referral with image_url (first image from gallery, empty string if no images)

        **Note:** Automatically updates the updated_at timestamp
      operationId: updateReferralById
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: string
                  format: uuid
                  description: "Referral ID (required)"
                name:
                  type: string
                  description: Home owner name
                phone:
                  type: string
                  description: Home owner phone
                email:
                  type: string
                  format: email
                  description: Home owner email
                address:
                  type: object
                  description: Complete address object
                street:
                  type: string
                  description: Street address
                city:
                  type: string
                  description: City name
                state:
                  description: "State (string abbreviation or object)"
                  oneOf:
                    - type: string
                    - type: object
                zip:
                  type: string
                  description: ZIP code
                job_type:
                  type: object
                  description: Job type object with id and name
                value:
                  type: number
                  description: Job value
                currency:
                  type: string
                  description: Currency code
                referral_percentage:
                  type: number
                  description: Referral percentage
                notes:
                  type: string
                  description: Job notes
                status:
                  description: "Status (string name or object)"
                  oneOf:
                    - type: string
                    - type: object
            examples:
              updateName:
                summary: Update home owner name
                value:
                  id: 550e8400-e29b-41d4-a716-446655440000
                  name: Jane Smith
              updateStatus:
                summary: Update status (string)
                value:
                  id: 550e8400-e29b-41d4-a716-446655440000
                  status: In Use
              updateMultipleFields:
                summary: Update multiple fields
                value:
                  id: 550e8400-e29b-41d4-a716-446655440000
                  name: John Doe
                  phone: +1-555-987-6543
                  city: San Francisco
                  value: 3500
      responses:
        '200':
          description: Referral updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Referral updated successfully
                  data:
                    $ref: '#/components/schemas/Referral'
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Referral not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /searchReferral:
    post:
      tags:
        - Referral Management
      summary: Search referrals with pagination
      description: |
        Searches referrals based on query and/or filters with pagination support.

        **Business Rules:**
        - Either `query` or `filters` must be provided (at least one is mandatory)
        - Query searches by home owner name or phone number (case-insensitive, partial match)
        - Filters can include: job_type, status, and/or value
        - If both query and filters are provided, all criteria are combined (AND logic)
        - Supports pagination with page and limit parameters (default: page=1, limit=10, max: 100)

        **Query:**
        - Searches in home_owner_info.name and home_owner_info.phone
        - Partial string matching, case-insensitive

        **Filters:**
        - job_type: Must be a JSON object with id and/or name
        - status: Must be a JSON object with id and/or name
        - value: Must be a number (exact match)
        - At least one filter field must be provided if using filters

        **Pagination:**
        - page: Page number (default: 1, min: 1)
        - limit: Results per page (default: 10, min: 1, max: 100)

        **Returns:** Paginated array of matching referrals ordered by created_at (newest first), each with image_url (first image from gallery, empty string if no images)
      operationId: searchReferral
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                query:
                  type: string
                  description: Search term for home owner name or phone number
                filters:
                  type: object
                  description: Filter criteria
                  properties:
                    job_type:
                      type: object
                      description: Filter by job type
                      properties:
                        id:
                          type: integer
                        name:
                          type: string
                    status:
                      type: object
                      description: Filter by status
                      properties:
                        id:
                          type: string
                          format: uuid
                        name:
                          type: string
                    value:
                      type: number
                      description: Filter by exact job value
                page:
                  type: integer
                  minimum: 1
                  default: 1
                  description: "Page number (default: 1)"
                limit:
                  type: integer
                  minimum: 1
                  maximum: 100
                  default: 10
                  description: "Results per page (default: 10, max: 100)"
            examples:
              searchByName:
                summary: Search by home owner name
                value:
                  query: John Doe
              searchByPhone:
                summary: Search by phone number
                value:
                  query: "555-123"
              filterByStatus:
                summary: Filter by status only
                value:
                  filters:
                    status:
                      name: Draft
              filterByJobType:
                summary: Filter by job type
                value:
                  filters:
                    job_type:
                      id: 3
                      name: Plumbing
              filterByValue:
                summary: Filter by job value
                value:
                  filters:
                    value: 2500
              combinedSearch:
                summary: Query with multiple filters
                value:
                  query: John
                  filters:
                    status:
                      id: d7db3360-6d15-4379-989c-560ae96bfa28
                      name: Draft
                    job_type:
                      id: 3
                      name: Plumbing
                    value: 2500
              paginatedSearch:
                summary: Search with pagination
                value:
                  query: John
                  page: 2
                  limit: 20
      responses:
        '200':
          description: Search results returned successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Found 5 referral(s)
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Referral'
                  pagination:
                    type: object
                    properties:
                      page:
                        type: integer
                        example: 1
                        description: Current page number
                      limit:
                        type: integer
                        example: 10
                        description: Results per page
                      total_count:
                        type: integer
                        example: 5
                        description: Total number of matching referrals
                      total_pages:
                        type: integer
                        example: 1
                        description: Total number of pages
                      has_next_page:
                        type: boolean
                        example: false
                        description: Whether there is a next page
                      has_previous_page:
                        type: boolean
                        example: false
                        description: Whether there is a previous page
              examples:
                foundResults:
                  summary: Results found
                  value:
                    status: success
                    message: Found 2 referral(s)
                    data:
                      - id: 550e8400-e29b-41d4-a716-446655440000
                        home_owner_info:
                          name: John Doe
                          address:
                            street: 123 Main St
                            city: Anytown
                            state:
                              name: California
                              abbreviation: CA
                            zip: "90210"
                          phone: +1-555-123-4567
                          email: john@example.com
                        job_details:
                          job_type:
                            id: 3
                            name: Plumbing
                          value: 2500
                          currency: USD
                          referral_percentage: 10
                          notes: Customer requested urgent service
                        status:
                          id: d7db3360-6d15-4379-989c-560ae96bfa28
                          name: Draft
                        created_at: "2025-01-19T10:00:00.000Z"
                        updated_at: "2025-01-19T10:00:00.000Z"
                    pagination:
                      page: 1
                      limit: 10
                      total_count: 2
                      total_pages: 1
                      has_next_page: false
                      has_previous_page: false
                noResults:
                  summary: No results found
                  value:
                    status: success
                    message: Found 0 referral(s)
                    data: []
                    pagination:
                      page: 1
                      limit: 10
                      total_count: 0
                      total_pages: 0
                      has_next_page: false
                      has_previous_page: false
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingBoth:
                  summary: Neither query nor filters provided
                  value:
                    error: INVALID_INPUT
                    message: Either 'query' or 'filters' must be provided
                invalidFilters:
                  summary: Filters not an object
                  value:
                    error: INVALID_INPUT
                    message: filters must be a JSON object
                noFilterFields:
                  summary: Empty filters object
                  value:
                    error: INVALID_INPUT
                    message: At least one filter (job_type, status, or value) must be provided
                invalidJobType:
                  summary: Invalid job_type format
                  value:
                    error: INVALID_INPUT
                    message: job_type must be a JSON object with id and name
                invalidValue:
                  summary: Invalid value type
                  value:
                    error: INVALID_INPUT
                    message: value must be a number
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /uploadImage:
    post:
      tags:
        - Gallery Management
      summary: Upload single or multiple images to referral gallery
      description: |
        Uploads one or more images to a referral's photo gallery.

        **Business Rules:**
        - Requires referral_id and image file(s) in multipart/form-data
        - If no gallery exists for the referral, creates one automatically
        - Uploads images to Supabase Storage in folder: gallery/{gallery_id}
        - Default image type is "none" for all images (can be changed later with changePhotoTypeById)
        - Supported formats: JPEG, PNG, WebP, HEIC, HEIF
        - Maximum file size per image: 4MB
        - Can upload multiple images in a single request
        - Partial success: If some images fail, successful ones are still uploaded

        **Returns:** Updated gallery with all successfully uploaded images
      operationId: uploadImage
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - referral_id
                - image
              properties:
                referral_id:
                  type: string
                  format: uuid
                  description: Referral ID to upload images for
                image:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: "One or more image files to upload (max 4MB each, JPEG/PNG/WebP/HEIC/HEIF)"
      responses:
        '201':
          description: Image(s) uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: "3 image(s) uploaded successfully"
                  data:
                    type: object
                    properties:
                      gallery:
                        $ref: '#/components/schemas/Gallery'
                      uploaded_images:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                            url:
                              type: string
                              format: uri
                            type:
                              type: string
                              enum: [before, after, none]
                      failed_uploads:
                        type: array
                        description: "List of files that failed to upload (only present if there are failures)"
                        items:
                          type: object
                          properties:
                            filename:
                              type: string
                            error:
                              type: string
                      summary:
                        type: object
                        properties:
                          total_attempted:
                            type: integer
                            example: 3
                          successful:
                            type: integer
                            example: 3
                          failed:
                            type: integer
                            example: 0
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingReferralId:
                  summary: Missing referral_id
                  value:
                    error: INVALID_INPUT
                    message: referral_id is required and must be a string
                missingImage:
                  summary: Missing image file
                  value:
                    error: INVALID_INPUT
                    message: At least one image file is required
                invalidFileType:
                  summary: Invalid file type
                  value:
                    error: INVALID_INPUT
                    message: 'File "image.gif" has invalid type. Only JPEG, PNG, WebP, HEIC, HEIF are allowed'
                fileTooLarge:
                  summary: File size exceeds limit
                  value:
                    error: INVALID_INPUT
                    message: 'File "large-image.jpg" exceeds 4MB size limit'
        '404':
          description: Referral not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: REFERRAL_NOT_FOUND
                message: Referral not found
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getPhotoGallery:
    post:
      tags:
        - Gallery Management
      summary: Get photo gallery for referral
      description: |
        Retrieves the photo gallery for a specific referral.

        **Business Rules:**
        - Requires referral_id in request body
        - Returns gallery with all images (before/after/none types)
        - Returns empty gallery structure if no gallery exists for the referral

        **Returns:** Gallery object with images array
      operationId: getPhotoGallery
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - referral_id
              properties:
                referral_id:
                  type: string
                  format: uuid
                  description: Referral ID to get gallery for
            example:
              referral_id: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Gallery retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Gallery retrieved successfully
                  data:
                    $ref: '#/components/schemas/Gallery'
              examples:
                withImages:
                  summary: Gallery with images
                  value:
                    status: success
                    message: Gallery retrieved successfully
                    data:
                      id: 660e8400-e29b-41d4-a716-446655440001
                      referral_id: 550e8400-e29b-41d4-a716-446655440000
                      images:
                        - id: 770e8400-e29b-41d4-a716-446655440002
                          url: https://example.supabase.co/storage/v1/object/public/images/gallery/660e8400/image1.jpg
                          type: before
                        - id: 880e8400-e29b-41d4-a716-446655440003
                          url: https://example.supabase.co/storage/v1/object/public/images/gallery/660e8400/image2.jpg
                          type: after
                        - id: 990e8400-e29b-41d4-a716-446655440004
                          url: https://example.supabase.co/storage/v1/object/public/images/gallery/660e8400/image3.jpg
                          type: none
                      created_at: "2025-01-19T10:00:00.000Z"
                      updated_at: "2025-01-19T11:30:00.000Z"
                emptyGallery:
                  summary: No gallery found
                  value:
                    status: success
                    message: No gallery found for this referral
                    data:
                      id: null
                      referral_id: 550e8400-e29b-41d4-a716-446655440000
                      images: []
                      created_at: null
                      updated_at: null
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: INVALID_INPUT
                message: referral_id is required
        '404':
          description: Referral not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: REFERRAL_NOT_FOUND
                message: Referral not found
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /changePhotoTypeById:
    patch:
      tags:
        - Gallery Management
      summary: Change photo type by ID
      description: |
        Updates the type of a specific photo in a gallery.

        **Business Rules:**
        - Requires id (photo ID) and type in request body
        - Valid types: "before", "after", "none"
        - Type is case-insensitive (automatically converted to lowercase)
        - Searches across all galleries to find the photo
        - Updates the photo type in the gallery's images array

        **Returns:** Updated gallery with modified photo
      operationId: changePhotoTypeById
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
                - type
              properties:
                id:
                  type: string
                  format: uuid
                  description: Photo ID to update
                type:
                  type: string
                  enum: [before, after, none, BEFORE, AFTER, NONE]
                  description: "New type for the photo (case-insensitive)"
            examples:
              changeToBefore:
                summary: Change to before type
                value:
                  id: 770e8400-e29b-41d4-a716-446655440002
                  type: before
              changeToAfter:
                summary: Change to after type
                value:
                  id: 880e8400-e29b-41d4-a716-446655440003
                  type: AFTER
              changeToNone:
                summary: Change to none type
                value:
                  id: 990e8400-e29b-41d4-a716-446655440004
                  type: none
      responses:
        '200':
          description: Photo type updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Photo type updated successfully
                  data:
                    type: object
                    properties:
                      gallery:
                        $ref: '#/components/schemas/Gallery'
                      updated_photo:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          url:
                            type: string
                            format: uri
                          type:
                            type: string
                            enum: [before, after, none]
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingId:
                  summary: Missing photo ID
                  value:
                    error: INVALID_INPUT
                    message: Photo ID is required
                missingType:
                  summary: Missing type
                  value:
                    error: INVALID_INPUT
                    message: Type is required
                invalidType:
                  summary: Invalid type value
                  value:
                    error: INVALID_INPUT
                    message: "Invalid type. Must be one of: before, after, none"
        '404':
          description: Photo not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: PHOTO_NOT_FOUND
                message: Photo not found in any gallery
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /deleteImage:
    delete:
      tags:
        - Gallery Management
      summary: Delete image from gallery
      description: |
        Deletes a specific image from a gallery.

        **Business Rules:**
        - Requires image ID in request body
        - Removes image from gallery's images array
        - Deletes image file from Supabase Storage
        - Searches across all galleries to find the image

        **Returns:** Updated gallery after image deletion
      operationId: deleteImage
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: string
                  format: uuid
                  description: Image ID to delete
            example:
              id: 770e8400-e29b-41d4-a716-446655440002
      responses:
        '200':
          description: Image deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Image deleted successfully
                  data:
                    type: object
                    properties:
                      gallery:
                        $ref: '#/components/schemas/Gallery'
                      deleted_image_id:
                        type: string
                        format: uuid
                        example: 770e8400-e29b-41d4-a716-446655440002
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: INVALID_INPUT
                message: Image ID is required
        '404':
          description: Image not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: IMAGE_NOT_FOUND
                message: Image not found in any gallery
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /deleteReferral:
    delete:
      tags:
        - Referral Management
      summary: Delete referral by ID
      description: |
        Deletes a specific referral by its ID.

        **Business Rules:**
        - Requires referral ID in request body
        - Cascades deletion to associated gallery (ON DELETE CASCADE)
        - Deletes all gallery images from Supabase Storage
        - Permanent deletion - cannot be undone

        **Returns:** Success message with deleted referral ID
      operationId: deleteReferral
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: string
                  format: uuid
                  description: Referral ID to delete
            example:
              id: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Referral deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Referral deleted successfully
                  data:
                    type: object
                    properties:
                      deleted_referral_id:
                        type: string
                        format: uuid
                        example: 550e8400-e29b-41d4-a716-446655440000
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: INVALID_INPUT
                message: Referral ID is required
        '404':
          description: Referral not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: REFERRAL_NOT_FOUND
                message: Referral not found
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getReferralHistory:
    post:
      tags:
        - Referral Management
      summary: Get referral history
      description: |
        Retrieves the complete history log for a specific referral.

        **Business Rules:**
        - Requires referral ID in request body
        - Returns all logged actions for the referral
        - Ordered by most recent first
        - Includes user information for each action

        **Returns:** Array of history entries with timestamps
      operationId: getReferralHistory
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: string
                  format: uuid
                  description: Referral ID to get history for
            example:
              id: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Referral history retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Referral history retrieved successfully
                  data:
                    type: object
                    properties:
                      referral_id:
                        type: string
                        format: uuid
                        example: 550e8400-e29b-41d4-a716-446655440000
                      history:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                            referral_id:
                              type: string
                              format: uuid
                            user_id:
                              type: string
                              format: uuid
                            user_name:
                              type: string
                              example: "Maaz Imtiaz"
                            action:
                              type: string
                              example: "created this referral"
                            created_at:
                              type: string
                              format: date-time
                        example:
                          - id: 123e4567-e89b-12d3-a456-426614174000
                            referral_id: 550e8400-e29b-41d4-a716-446655440000
                            user_id: 789e0123-e89b-12d3-a456-426614174000
                            user_name: "Maaz Imtiaz"
                            action: "uploaded 4 photos to this referral"
                            created_at: "2025-01-19T14:30:00Z"
                          - id: 223e4567-e89b-12d3-a456-426614174000
                            referral_id: 550e8400-e29b-41d4-a716-446655440000
                            user_id: 789e0123-e89b-12d3-a456-426614174000
                            user_name: "Maaz Imtiaz"
                            action: "changed homeowner address"
                            created_at: "2025-01-19T12:15:00Z"
                          - id: 323e4567-e89b-12d3-a456-426614174000
                            referral_id: 550e8400-e29b-41d4-a716-446655440000
                            user_id: 789e0123-e89b-12d3-a456-426614174000
                            user_name: "Maaz Imtiaz"
                            action: "created this referral"
                            created_at: "2025-01-19T10:00:00Z"
                      count:
                        type: integer
                        example: 3
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: INVALID_INPUT
                message: Referral ID is required
        '404':
          description: Referral not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: REFERRAL_NOT_FOUND
                message: Referral not found
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getAllCampaignStatus:
    get:
      tags:
        - Campaign Management
      summary: Get all campaign status types
      description: |
        Returns all available campaign status types.

        **Available Statuses:**
        - Draft: Campaign is being created
        - Active: Campaign is live and running
        - In Active: Campaign is paused or ended

        **Returns:** List of all campaign status types
      operationId: getAllCampaignStatus
      responses:
        '200':
          description: Campaign status types retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        name:
                          type: string
                          example: Draft
                        created_at:
                          type: string
                          format: date-time
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getAllConsents:
    get:
      tags:
        - Campaign Management
      summary: Get all campaign disclaimers/consents
      description: |
        Returns all campaign disclaimers/consents from the campaign_disclaimers table.

        **Business Rules:**
        - Requires authentication (use "Authorize" button at top with SupabaseAuth and BearerAuth)
        - Returns all disclaimer texts with their IDs and values
        - Used for displaying consent checkboxes in campaign creation Step 6

        **Use Case:**
        - Fetch disclaimers to show in campaign creation UI
        - Users must accept all consents (set to true) in Step 6

        **Authentication:** Requires JWT authentication (use "Authorize" button at top)
      operationId: getAllConsents
      security:
        - SupabaseAuth: []
          BearerAuth: []
      responses:
        '200':
          description: Consents retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                          example: "123e4567-e89b-12d3-a456-426614174000"
                        disclaimer_text:
                          type: string
                          example: "I confirm all campaign details are correct and approved for mailing."
                        value:
                          type: boolean
                          example: true
                        created_at:
                          type: string
                          format: date-time
                          example: "2025-01-26T12:00:00Z"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'


  /createCampaign:
    post:
      tags:
        - Campaign Management
      summary: Create or update campaign (multi-step)
      description: |
        Multi-step campaign creation process. Each step updates the campaign.

        **Step 1: Link Referral and Set Campaign Name**
        Creates a draft campaign linked to a referral with a campaign name.

        **Step 2: Select Templates**
        Selects templates for front and back of the postcard. Accepts both database UUIDs and PostGrid template IDs. Updates templates' campaigns_used array with campaign name.

        **Step 3: Add Offer Details**
        Adds offer headline, description, dates, CTA, and disclaimer.

        **Step 4: Add Business Details**
        Adds business name, phone, website, QR URL, and before/after images.

        **Step 5: Link Zone to Campaign**
        Links a location zone (from getAddressesFromZone) to the campaign by saving zone_id.

        **Step 6: Campaign Consents/Disclaimers**
        Validates and stores campaign consents. All consents must be provided and set to true.

        **Business Rules:**
        - Organization-based (user must be in organization)
        - Step 1 creates new campaign, steps 2-6 require campaign_id
        - Each step advances current_step counter
        - Campaign starts in Draft status
        - Step 6 validates all consents are true, stores them in campaign

        **Returns:** Updated campaign object
      operationId: createCampaign
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - type: object
                  title: Step 1
                  required:
                    - step
                    - referral_id
                    - campaign_name
                  properties:
                    step:
                      type: integer
                      example: 1
                    referral_id:
                      type: string
                      format: uuid
                    campaign_name:
                      type: string
                      description: Name of the campaign
                - type: object
                  title: Step 2
                  required:
                    - step
                    - campaign_id
                    - front_template_id
                    - back_template_id
                  properties:
                    step:
                      type: integer
                      example: 2
                    campaign_id:
                      type: string
                      format: uuid
                    front_template_id:
                      type: string
                      description: Template ID for front of postcard (accepts both database UUID or PostGrid template ID)
                      example: "a7b3c4d5-e6f7-8901-2345-6789abcdef01"
                    back_template_id:
                      type: string
                      description: Template ID for back of postcard (accepts both database UUID or PostGrid template ID)
                      example: "template_abc123xyz"
                - type: object
                  title: Step 3
                  required:
                    - step
                    - campaign_id
                    - data
                  properties:
                    step:
                      type: integer
                      example: 3
                    campaign_id:
                      type: string
                      format: uuid
                    data:
                      type: object
                      required:
                        - offer_headline
                        - offer_description
                        - start_date
                        - end_date
                        - cta_text
                        - disclaimer_text
                      properties:
                        offer_headline:
                          type: string
                        offer_description:
                          type: string
                        start_date:
                          type: string
                          format: date
                        end_date:
                          type: string
                          format: date
                        cta_text:
                          type: string
                        disclaimer_text:
                          type: string
                - type: object
                  title: Step 4
                  required:
                    - step
                    - campaign_id
                    - data
                  properties:
                    step:
                      type: integer
                      example: 4
                    campaign_id:
                      type: string
                      format: uuid
                    data:
                      type: object
                      required:
                        - business_name
                        - phone
                        - website
                        - qr_url
                        - before_image_id
                        - after_image_id
                      properties:
                        business_name:
                          type: string
                        phone:
                          type: string
                        website:
                          type: string
                        qr_url:
                          type: string
                        before_image_id:
                          type: string
                          format: uuid
                          description: ID of before image from referral's gallery
                        after_image_id:
                          type: string
                          format: uuid
                          description: ID of after image from referral's gallery
                - type: object
                  title: Step 5
                  required:
                    - step
                    - campaign_id
                    - zone_id
                  properties:
                    step:
                      type: integer
                      example: 5
                    campaign_id:
                      type: string
                      format: uuid
                      description: Campaign ID
                    zone_id:
                      type: string
                      format: uuid
                      description: Zone ID from getAddressesFromZone response
                - type: object
                  title: Step 6
                  required:
                    - step
                    - campaign_id
                    - consent
                  properties:
                    step:
                      type: integer
                      example: 6
                    campaign_id:
                      type: string
                      format: uuid
                      description: Campaign ID
                    consent:
                      type: object
                      description: Object containing consent IDs as keys and boolean values (all must be true)
                      additionalProperties:
                        type: boolean
                      example:
                        "123e4567-e89b-12d3-a456-426614174000": true
                        "223e4567-e89b-12d3-a456-426614174001": true
                        "323e4567-e89b-12d3-a456-426614174002": true
            examples:
              step1:
                summary: Step 1 - Link Referral and Set Campaign Name
                value:
                  step: 1
                  referral_id: 550e8400-e29b-41d4-a716-446655440000
                  campaign_name: Summer Promotion 2025
              step2:
                summary: Step 2 - Select Templates (accepts database UUID or PostGrid template ID)
                value:
                  step: 2
                  campaign_id: 660e8400-e29b-41d4-a716-446655440001
                  front_template_id: "a7b3c4d5-e6f7-8901-2345-6789abcdef01"
                  back_template_id: "template_abc123xyz"
              step3:
                summary: Step 3 - Add Offer Details
                value:
                  step: 3
                  campaign_id: 660e8400-e29b-41d4-a716-446655440001
                  data:
                    offer_headline: "Special Spring Discount!"
                    offer_description: "Get 20% off all services this month"
                    start_date: "2025-03-01"
                    end_date: "2025-03-31"
                    cta_text: "Call Now to Redeem"
                    disclaimer_text: "Offer valid for new customers only"
              step4:
                summary: Step 4 - Add Business Details and Images
                value:
                  step: 4
                  campaign_id: 660e8400-e29b-41d4-a716-446655440001
                  data:
                    business_name: "ABC Home Services"
                    phone: "+1-555-123-4567"
                    website: "https://abchome.com"
                    qr_url: "https://abchome.com/spring-promo"
                    before_image_id: "770e8400-e29b-41d4-a716-446655440002"
                    after_image_id: "880e8400-e29b-41d4-a716-446655440003"
              step5:
                summary: Step 5 - Link Zone to Campaign
                value:
                  step: 5
                  campaign_id: 660e8400-e29b-41d4-a716-446655440001
                  zone_id: 123e4567-e89b-12d3-a456-426614174000
              step6:
                summary: Step 6 - Campaign Consents
                value:
                  step: 6
                  campaign_id: 660e8400-e29b-41d4-a716-446655440001
                  consent:
                    "123e4567-e89b-12d3-a456-426614174000": true
                    "223e4567-e89b-12d3-a456-426614174001": true
                    "323e4567-e89b-12d3-a456-426614174002": true
      responses:
        '200':
          description: Campaign updated successfully (steps 2-4)
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: "Templates selected successfully (Step 2 complete)"
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      organization_id:
                        type: string
                        format: uuid
                      referral_id:
                        type: string
                        format: uuid
                      campaign_name:
                        type: string
                      front_template_id:
                        type: string
                        description: PostGrid template ID for front
                      back_template_id:
                        type: string
                        description: PostGrid template ID for back
                      status:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          name:
                            type: string
                            example: Draft
                      current_step:
                        type: integer
                        example: 2
                      image_url:
                        type: string
                        nullable: true
                      templates_info:
                        type: object
                        description: Detailed template information
                        properties:
                          front_template:
                            type: object
                            properties:
                              db_id:
                                type: string
                                format: uuid
                                description: Database template ID
                              postgrid_id:
                                type: string
                                description: PostGrid template ID
                          back_template:
                            type: object
                            properties:
                              db_id:
                                type: string
                                format: uuid
                                description: Database template ID
                              postgrid_id:
                                type: string
                                description: PostGrid template ID
                      offer_data:
                        type: object
                        nullable: true
                      business_data:
                        type: object
                        nullable: true
                      created_at:
                        type: string
                        format: date-time
                      updated_at:
                        type: string
                        format: date-time
        '201':
          description: Campaign created successfully (step 1)
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: "Campaign created successfully (Step 1 complete)"
                  data:
                    type: object
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: User not in organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Referral or campaign not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '501':
          description: Step not yet implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getCampaignStep:
    post:
      tags:
        - Campaign Management
      summary: Get campaign current step
      description: |
        Returns the current step and complete details of a campaign.

        **Business Rules:**
        - Requires campaign_id in request body
        - Organization-based (user must be in organization)
        - Returns current_step (0-6) and all campaign data

        **Use Case:**
        Check which step the campaign is on to resume creation process.

        **Returns:** Campaign details with current step information
      operationId: getCampaignStep
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - campaign_id
              properties:
                campaign_id:
                  type: string
                  format: uuid
                  description: Campaign ID to check
            example:
              campaign_id: 660e8400-e29b-41d4-a716-446655440001
      responses:
        '200':
          description: Campaign step retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: "Campaign is at step 3"
                  data:
                    type: object
                    properties:
                      campaign_id:
                        type: string
                        format: uuid
                      current_step:
                        type: integer
                        example: 3
                      status:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          name:
                            type: string
                            example: Draft
                      referral_id:
                        type: string
                        format: uuid
                      template_id:
                        type: string
                      offer_data:
                        type: object
                      business_data:
                        type: object
                      created_at:
                        type: string
                        format: date-time
                      updated_at:
                        type: string
                        format: date-time
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: User not in organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Campaign not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getCampaignById:
    post:
      tags:
        - Campaign Management
      summary: Get campaign by ID
      description: Returns complete campaign information by campaign ID
      operationId: getCampaignById
      security:
        - SupabaseAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: string
                  format: uuid
                  description: Campaign ID
            example:
              id: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '200':
          description: Campaign retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Campaign'
        '401':
          description: Unauthorized
        '403':
          description: User not in organization
        '404':
          description: Campaign not found
        '500':
          description: Internal server error

  /getCampaignInformationByReferralId:
    post:
      tags:
        - Campaign Management
      summary: Get campaign by referral ID
      description: Returns campaign associated with a specific referral
      operationId: getCampaignInformationByReferralId
      security:
        - SupabaseAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: string
                  format: uuid
                  description: Referral ID
            example:
              id: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '200':
          description: Campaign retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Campaign'
        '401':
          description: Unauthorized
        '403':
          description: User not in organization
        '404':
          description: Referral not found or not associated with any campaign
        '500':
          description: Internal server error

  /getAllCampaigns:
    get:
      tags:
        - Campaign Management
      summary: Get all campaigns (paginated)
      description: Returns a paginated list of campaigns from the user's organization
      operationId: getAllCampaigns
      security:
        - SupabaseAuth: []
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number (default 1)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Results per page (default 10, max 100)
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
      responses:
        '200':
          description: Campaigns retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Campaign'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          description: Unauthorized
        '403':
          description: User not in organization
        '500':
          description: Internal server error

  /searchCampaign:
    post:
      tags:
        - Campaign Management
      summary: Search campaigns with filters
      description: |
        Search campaigns with filters. At least query or filters must be provided.

        **Query Search:**
        - Searches in: campaign_name, offer headline, offer description

        **Filters:**
        - status: Campaign status (Draft, Active, In Active)
        - start_date: Campaign start date (from offer_data)
        - end_date: Campaign expiry date (from offer_data)
        - created_by: User ID who created the campaign

        **Returns:** Campaigns with image_url (first image from referral gallery) and campaign_name
      operationId: searchCampaign
      security:
        - SupabaseAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                query:
                  type: string
                  description: Search query (searches in campaign_name, offer headline, and offer description)
                filters:
                  type: object
                  properties:
                    status:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        name:
                          type: string
                          enum: [Draft, Active, In Active]
                    start_date:
                      type: string
                      format: date
                      description: Filter by campaign start date
                    end_date:
                      type: string
                      format: date
                      description: Filter by campaign expiry date
                    created_by:
                      type: string
                      format: uuid
                      description: Filter by creator user ID
                page:
                  type: integer
                  minimum: 1
                  default: 1
                limit:
                  type: integer
                  minimum: 1
                  maximum: 100
                  default: 10
            examples:
              filterByStatus:
                summary: Filter by status
                value:
                  filters:
                    status:
                      name: "Active"
                  page: 1
                  limit: 10
              filterByDates:
                summary: Filter by date range
                value:
                  filters:
                    start_date: "2025-01-01"
                    end_date: "2025-12-31"
                  page: 1
                  limit: 10
              searchQuery:
                summary: Search by query
                value:
                  query: "summer promo"
                  page: 1
                  limit: 10
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Campaign'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '400':
          description: Invalid input (query or filters required)
        '401':
          description: Unauthorized
        '403':
          description: User not in organization
        '500':
          description: Internal server error

  /getCampaignHistory:
    post:
      tags:
        - Campaign Management
      summary: Get campaign history
      description: |
        Returns the complete history log for a specific campaign.

        **Logged Actions Include:**
        - Step 1: Linked referral to campaign
        - Step 2: Selected PostGrid template
        - Step 3: Added offer details
        - Step 4: Added business details and images
        - Step 5: Linked location zone to campaign
        - Step 6: Completed campaign consents and disclaimers
        - Any manual updates via updateCampaignById

        History entries include user information (who performed the action) and timestamp.
      operationId: getCampaignHistory
      security:
        - SupabaseAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: string
                  format: uuid
                  description: Campaign ID
            example:
              id: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '200':
          description: Campaign history retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      campaign_id:
                        type: string
                        format: uuid
                      history:
                        type: array
                        items:
                          $ref: '#/components/schemas/CampaignHistoryEntry'
                      count:
                        type: integer
        '401':
          description: Unauthorized
        '403':
          description: User not in organization
        '404':
          description: Campaign not found
        '500':
          description: Internal server error

  /updateCampaignById:
    patch:
      tags:
        - Campaign Management
      summary: Update campaign by ID
      description: |
        Updates a campaign by ID. Can update any field except ID and organization_id.
        All changes are logged to campaign_history.

        **Updatable Fields:**
        - referral_id: Change linked referral
        - campaign_name: Update campaign name
        - status: Update campaign status
        - current_step: Update current step
        - front_template_id: Change PostGrid template for front of postcard
        - back_template_id: Change PostGrid template for back of postcard
        - zone_id: Change linked location zone
        - offer_data: Update offer details (merged with existing)
        - business_data: Update business details (merged with existing)
        - additional_data: Update additional data (merged with existing)
        - postcards_sent: Update number of postcards sent
        - scan_rate: Update scan rate percentage
        - leads_gen: Update leads generated count
        - total_spent: Update total amount spent
        - roi: Update return on investment

        **Returns:** Updated campaign with image_url from referral gallery
      operationId: updateCampaignById
      security:
        - SupabaseAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: string
                  format: uuid
                referral_id:
                  type: string
                  format: uuid
                campaign_name:
                  type: string
                  description: Campaign name
                status:
                  oneOf:
                    - type: string
                      enum: [Draft, Active, In Active]
                    - type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        name:
                          type: string
                current_step:
                  type: integer
                  minimum: 0
                  maximum: 6
                front_template_id:
                  type: string
                  description: PostGrid template ID for front of postcard
                back_template_id:
                  type: string
                  description: PostGrid template ID for back of postcard
                zone_id:
                  type: string
                  format: uuid
                  description: Location zone ID
                offer_data:
                  type: object
                business_data:
                  type: object
                additional_data:
                  type: object
                postcards_sent:
                  type: integer
                scan_rate:
                  type: number
                  format: decimal
                leads_gen:
                  type: integer
                total_spent:
                  type: number
                  format: decimal
                roi:
                  type: number
                  format: decimal
            examples:
              updateStatus:
                summary: Update campaign status
                value:
                  id: "123e4567-e89b-12d3-a456-426614174000"
                  status: "Active"
              updateMetrics:
                summary: Update campaign metrics
                value:
                  id: "123e4567-e89b-12d3-a456-426614174000"
                  postcards_sent: 500
                  scan_rate: 12.5
                  leads_gen: 62
                  total_spent: 750.00
                  roi: 250.00
      responses:
        '200':
          description: Campaign updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Campaign'
        '400':
          description: Invalid input
        '401':
          description: Unauthorized
        '403':
          description: User not in organization
        '404':
          description: Campaign not found
        '500':
          description: Internal server error

  /deleteCampaign:
    delete:
      tags:
        - Campaign Management
      summary: Delete campaign by ID
      description: |
        Deletes a campaign by ID. This action is irreversible.

        **Cascade Behavior:**
        - Automatically deletes all campaign_history entries (ON DELETE CASCADE)
        - Sets campaign_id to NULL in associated referrals (ON DELETE SET NULL)
        - Logs deletion action before removing the campaign

        **Security:**
        - Organization-based: Can only delete campaigns in user's organization
        - Requires authentication
      operationId: deleteCampaign
      security:
        - SupabaseAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: string
                  format: uuid
                  description: Campaign ID to delete
            example:
              id: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '200':
          description: Campaign deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Campaign deleted successfully
                  data:
                    type: object
                    properties:
                      deleted_campaign_id:
                        type: string
                        format: uuid
              example:
                status: success
                message: Campaign deleted successfully
                data:
                  deleted_campaign_id: "123e4567-e89b-12d3-a456-426614174000"
        '400':
          description: Invalid input (missing campaign ID)
        '401':
          description: Unauthorized
        '403':
          description: User not in organization
        '404':
          description: Campaign not found in user's organization
        '500':
          description: Internal server error



  /getOrganization:
    get:
      tags:
        - Organization Management
      summary: Get organization information
      description: |
        Retrieves organization information based on the authenticated user's role.

        **Intelligent Role-Based Retrieval:**
        - **ADMIN users:** Returns the organization where they are the owner (owner_id = their UID)
        - **MARKETER users:** Returns the organization where they are listed as a member
        - **TECHNICIAN users:** Returns the organization where they are listed as a member

        **Returns:**
        - Complete organization details including business information
        - List of all organization members (with their UIDs and roles)
        - Organization owner information
        - Timestamps for creation and last update
      operationId: getOrganization
      security:
        - SupabaseAuth: []
        - BearerAuth: []
      responses:
        '200':
          description: Organization retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetOrganizationResponse'
              examples:
                adminView:
                  summary: Admin viewing their organization
                  value:
                    status: success
                    data:
                      id: 770e8400-e29b-41d4-a716-446655440003
                      owner_id: 550e8400-e29b-41d4-a716-446655440000
                      business_name: Tech Solutions Inc
                      business_address: 123 Main Street, Silicon Valley, CA 94025
                      business_email: contact@techsolutions.com
                      registration_number: REG-2025-12345
                      industry: Technology
                      phone_number: +1-555-123-4567
                      website_url: https://techsolutions.com
                      organization_members:
                        - member_uid: 660e8400-e29b-41d4-a716-446655440001
                          member_role: MARKETER
                        - member_uid: 660e8400-e29b-41d4-a716-446655440002
                          member_role: TECHNICIAN
                      created_at: '2025-01-18T10:00:00.000Z'
                      updated_at: '2025-01-18T15:30:00.000Z'
                memberView:
                  summary: MARKETER/TECHNICIAN viewing their organization
                  value:
                    status: success
                    data:
                      id: 770e8400-e29b-41d4-a716-446655440003
                      owner_id: 550e8400-e29b-41d4-a716-446655440000
                      business_name: Tech Solutions Inc
                      business_address: 123 Main Street, Silicon Valley, CA 94025
                      business_email: contact@techsolutions.com
                      registration_number: REG-2025-12345
                      industry: Technology
                      phone_number: +1-555-123-4567
                      website_url: https://techsolutions.com
                      organization_members:
                        - member_uid: 660e8400-e29b-41d4-a716-446655440001
                          member_role: MARKETER
                        - member_uid: 660e8400-e29b-41d4-a716-446655440002
                          member_role: TECHNICIAN
                      created_at: '2025-01-18T10:00:00.000Z'
                      updated_at: '2025-01-18T15:30:00.000Z'
        '401':
          description: Unauthorized - Missing or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingAuth:
                  summary: Missing authorization header
                  value:
                    error: UNAUTHORIZED
                    message: Authorization header is required
                invalidToken:
                  summary: Invalid token
                  value:
                    error: INVALID_TOKEN
                    message: Invalid or expired token
        '404':
          description: Organization not found or user not associated with any organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                notFound:
                  summary: Organization not found
                  value:
                    error: ORGANIZATION_NOT_FOUND
                    message: Organization not found
                notMember:
                  summary: User not associated with organization
                  value:
                    error: ORGANIZATION_NOT_FOUND
                    message: You are not associated with any organization
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /getAllFonts:
    get:
      tags:
        - Settings Management
      summary: Get all available Google Fonts
      description: |
        Returns a list of all available Google Fonts for use in branding settings.

        **Business Rules:**
        - Returns list of popular Google Fonts
        - Falls back to curated list if API unavailable
        - User must be authenticated

        **Returns:** Array of fonts with name, category, variants, and subsets
      operationId: getAllFonts
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Fonts retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Retrieved 15 fonts"
                  fonts:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          example: "Poppins"
                        category:
                          type: string
                          example: "sans-serif"
                        variants:
                          type: array
                          items:
                            type: string
                          example: ["regular", "500", "600", "700"]
                        subsets:
                          type: array
                          items:
                            type: string
                          example: ["latin"]
                  processingTimeMs:
                    type: integer
                    example: 245
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: User not in organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /updateBrandingSettings:
    post:
      tags:
        - Settings Management
      summary: Update user branding settings
      description: |
        Updates user-specific branding settings including theme colors and fonts.

        **Business Rules:**
        - Settings are user-specific (not organization-wide)
        - Colors must be valid hex format
        - Font names should match Google Fonts
        - Updates are reflected in getAppContent response

        **Returns:** Updated branding settings
      operationId: updateBrandingSettings
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - theme
              properties:
                theme:
                  type: object
                  required:
                    - colors
                    - fonts
                  properties:
                    colors:
                      type: object
                      required:
                        - primary
                        - secondary
                        - accent
                      properties:
                        primary:
                          type: string
                          example: "#E36A00"
                        secondary:
                          type: string
                          example: "#1D1D20"
                        accent:
                          type: string
                          example: "#47BAD7"
                    fonts:
                      type: object
                      required:
                        - primary
                        - body
                      properties:
                        primary:
                          type: object
                          required:
                            - name
                          properties:
                            name:
                              type: string
                              example: "Poppins"
                        body:
                          type: object
                          required:
                            - name
                          properties:
                            name:
                              type: string
                              example: "Poppins"
            example:
              theme:
                colors:
                  primary: "#E36A00"
                  secondary: "#1D1D20"
                  accent: "#47BAD7"
                fonts:
                  primary:
                    name: "Poppins"
                  body:
                    name: "Poppins"
      responses:
        '200':
          description: Branding settings updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Branding settings updated successfully"
                  branding_settings:
                    type: object
                  processingTimeMs:
                    type: integer
                    example: 128
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidColor:
                  value:
                    error: "INVALID_INPUT"
                    message: "primary color must be a valid hex color (e.g., #E36A00)"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: User not in organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    SignUpRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User's email address
          example: user@example.com
        password:
          type: string
          format: password
          minLength: 8
          description: |
            User's password must meet the following requirements:
            - At least 8 characters long
            - At least one uppercase letter (A-Z)
            - At least one lowercase letter (a-z)
            - At least one number (0-9)
            - At least one special character (!@#$%^&* etc.)
          example: SecurePass123!
        fullName:
          type: string
          description: "User's full name (optional)"
          example: John Doe
        role:
          type: string
          enum: [ADMIN, MARKETER, TECHNICIAN]
          description: "User role (default is TECHNICIAN). ADMIN role requires authenticated ADMIN user."
          example: TECHNICIAN

    SignUpResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        message:
          type: string
          example: User created successfully
        user:
          type: object
          properties:
            id:
              type: string
              format: uuid
              example: 550e8400-e29b-41d4-a716-446655440000
            email:
              type: string
              format: email
              example: user@example.com
            fullName:
              type: string
              nullable: true
              example: John Doe
            role:
              type: string
              enum: [ADMIN, MARKETER, TECHNICIAN]
              example: TECHNICIAN

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User's email address
          example: user@example.com
        password:
          type: string
          format: password
          description: |
            User's password must meet the following requirements:
            - At least 8 characters long
            - At least one uppercase letter (A-Z)
            - At least one lowercase letter (a-z)
            - At least one number (0-9)
            - At least one special character (!@#$%^&* etc.)
          example: SecurePass123!

    LoginResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        message:
          type: string
          example: Login successful
        token:
          type: string
          description: "JWT access token from Supabase Auth (expires in 1 hour)"
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAiLCJlbWFpbCI6InVzZXJAZXhhbXBsZS5jb20iLCJpYXQiOjE3MDAwMDAwMDAsImV4cCI6MTcwMDAwMzYwMH0.signature
        refreshToken:
          type: string
          description: Refresh token for obtaining new access tokens
          example: xYz123RefreshToken456...
        expiresIn:
          type: number
          description: Access token expiry time in seconds
          example: 3600
        role:
          type: string
          enum: [ADMIN, MARKETER, TECHNICIAN]
          description: User's assigned role
          example: TECHNICIAN
        user:
          type: object
          properties:
            id:
              type: string
              format: uuid
              example: 550e8400-e29b-41d4-a716-446655440000
            email:
              type: string
              format: email
              example: user@example.com
            fullName:
              type: string
              nullable: true
              example: John Doe

    ForgotPasswordRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email
          description: User's email address
          example: user@example.com

    ResetPasswordRequest:
      type: object
      required:
        - access_token
        - newPassword
      properties:
        access_token:
          type: string
          description: Access token from password reset email URL
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        newPassword:
          type: string
          format: password
          minLength: 8
          description: |
            New password must meet the following requirements:
            - At least 8 characters long
            - At least one uppercase letter (A-Z)
            - At least one lowercase letter (a-z)
            - At least one number (0-9)
            - At least one special character (!@#$%^&* etc.)
          example: NewSecurePass123!

    GetUserResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        data:
          type: object
          properties:
            id:
              type: string
              format: uuid
              description: User's unique identifier
              example: 550e8400-e29b-41d4-a716-446655440000
            email:
              type: string
              format: email
              description: User's email address
              example: tech@example.com
            role:
              type: string
              enum: [ADMIN, MARKETER, TECHNICIAN]
              description: User's assigned role
              example: TECHNICIAN
            full_name:
              type: string
              nullable: true
              description: User's full name
              example: John Technician
            created_at:
              type: string
              format: date-time
              description: Account creation timestamp
              example: '2025-01-13T10:00:00.000Z'

    MenuItem:
      type: object
      required:
        - name
        - title
        - description
        - id
        - enabled
        - extended
        - extended_options
      properties:
        name:
          type: string
          description: Unique identifier for the menu item
          example: dashboard
        title:
          type: string
          description: Display title for the menu item
          example: Dashboard
        description:
          type: string
          description: Description or subtitle for the menu item
          example: Create, Navigate, Lead & Iterate
        id:
          type: integer
          description: Numeric identifier for the menu item
          example: 1
        enabled:
          type: boolean
          description: Whether the menu item is enabled for this user role
          example: true
        extended:
          type: boolean
          description: Whether this menu item has sub-options
          example: false
        extended_options:
          type: array
          description: Array of sub-menu items if extended is true
          items:
            $ref: '#/components/schemas/MenuItem'

    MessageResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        message:
          type: string
          description: Success message
          example: Operation completed successfully

    Error:
      type: object
      properties:
        error:
          type: string
          description: Error code
          example: INVALID_INPUT
        message:
          type: string
          description: Human-readable error message
          example: Email and password are required

    OrganizationMember:
      type: object
      properties:
        member_uid:
          type: string
          format: uuid
          description: User ID of the organization member
          example: 660e8400-e29b-41d4-a716-446655440001
        member_role:
          type: string
          enum: [ADMIN, MARKETER, TECHNICIAN]
          description: Role of the member in the organization
          example: MARKETER

    Organization:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Organization's unique identifier
          example: 770e8400-e29b-41d4-a716-446655440003
        owner_id:
          type: string
          format: uuid
          description: "User ID of the organization owner (ADMIN)"
          example: 550e8400-e29b-41d4-a716-446655440000
        business_name:
          type: string
          nullable: true
          description: Name of the business/organization
          example: Tech Solutions Inc
        registration_number:
          type: string
          nullable: true
          description: Business registration number
          example: REG-2025-12345
        industry:
          type: string
          nullable: true
          description: Industry sector
          example: Technology
        business_address:
          type: string
          nullable: true
          description: Business physical address
          example: 123 Main Street, Silicon Valley, CA 94025
        business_email:
          type: string
          format: email
          nullable: true
          description: Business contact email
          example: contact@techsolutions.com
        phone_number:
          type: string
          nullable: true
          description: Business phone number
          example: +1-555-123-4567
        website_url:
          type: string
          format: uri
          nullable: true
          description: Business website URL
          example: https://techsolutions.com
        organization_members:
          type: array
          items:
            $ref: '#/components/schemas/OrganizationMember'
          description: "List of organization members (MARKETER and TECHNICIAN users)"
        created_at:
          type: string
          format: date-time
          description: Organization creation timestamp
          example: '2025-01-18T10:00:00.000Z'
        updated_at:
          type: string
          format: date-time
          description: Organization last update timestamp
          example: '2025-01-18T15:30:00.000Z'

    SaveOrganizationRequest:
      type: object
      required:
        - business_name
        - business_address
        - business_email
      properties:
        business_name:
          type: string
          description: "Name of the business/organization (required)"
          example: Tech Solutions Inc
        registration_number:
          type: string
          description: "Business registration number (optional)"
          example: REG-2025-12345
        industry:
          type: string
          description: "Industry sector (optional)"
          example: Technology
        business_address:
          type: string
          description: "Business physical address (required)"
          example: 123 Main Street, Silicon Valley, CA 94025
        business_email:
          type: string
          format: email
          description: "Business contact email (required)"
          example: contact@techsolutions.com
        phone_number:
          type: string
          description: "Business phone number (optional)"
          example: +1-555-123-4567
        website_url:
          type: string
          format: uri
          description: "Business website URL (optional)"
          example: https://techsolutions.com

    GetOrganizationResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        data:
          $ref: '#/components/schemas/Organization'

    Referral:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Referral unique identifier
          example: 550e8400-e29b-41d4-a716-446655440000
        home_owner_info:
          type: object
          properties:
            name:
              type: string
              description: Home owner name
              example: John Doe
            address:
              type: object
              properties:
                street:
                  type: string
                  description: Street address
                  example: 123 Main St
                city:
                  type: string
                  description: City name
                  example: Anytown
                state:
                  type: object
                  properties:
                    name:
                      type: string
                      description: Full state name
                      example: California
                    abbreviation:
                      type: string
                      description: State abbreviation
                      example: CA
                zip:
                  type: string
                  description: ZIP code
                  example: '90210'
            phone:
              type: string
              description: Phone number
              example: +1-555-123-4567
            email:
              type: string
              format: email
              description: Email address
              example: john@example.com
        job_details:
          type: object
          properties:
            job_type:
              type: object
              properties:
                id:
                  type: string
                  format: uuid
                  description: Job type ID
                  example: 3
                name:
                  type: string
                  description: Job type name
                  example: Plumbing
            value:
              type: number
              description: Job value
              example: 2500
            currency:
              type: string
              description: Currency code
              example: USD
            referral_percentage:
              type: number
              description: Referral percentage
              example: 10
            notes:
              type: string
              description: Additional notes
              example: Customer requested urgent service.
        status:
          type: object
          properties:
            id:
              type: string
              format: uuid
              description: Status ID
              example: d7db3360-6d15-4379-989c-560ae96bfa28
            name:
              type: string
              description: Status name
              example: Draft
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
          example: '2025-01-19T10:00:00.000Z'
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
          example: '2025-01-19T10:00:00.000Z'
        image_url:
          type: string
          format: uri
          description: URL of the first image from the referral's gallery (empty string if no images)
          example: https://example.supabase.co/storage/v1/object/public/images/gallery/660e8400/image1.jpg

    Gallery:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Gallery unique identifier
          example: 660e8400-e29b-41d4-a716-446655440001
        referral_id:
          type: string
          format: uuid
          description: Referral ID linked to this gallery
          example: 550e8400-e29b-41d4-a716-446655440000
        images:
          type: array
          description: Array of images in the gallery
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
                description: Image unique identifier
                example: 770e8400-e29b-41d4-a716-446655440002
              url:
                type: string
                format: uri
                description: Public URL of the image
                example: https://example.supabase.co/storage/v1/object/public/images/gallery/660e8400/image1.jpg
              type:
                type: string
                enum: [before, after, none]
                description: Image type classification
                example: before
        created_at:
          type: string
          format: date-time
          description: Gallery creation timestamp
          example: '2025-01-19T10:00:00.000Z'
        updated_at:
          type: string
          format: date-time
          description: Gallery last update timestamp
          example: '2025-01-19T11:30:00.000Z'

    Campaign:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Campaign ID
        organization_id:
          type: string
          format: uuid
          description: Organization ID
        referral_id:
          type: string
          format: uuid
          nullable: true
          description: Associated referral ID
        campaign_name:
          type: string
          nullable: true
          description: Name of the campaign (set in step 1)
          example: Summer Promotion 2025
        status:
          type: object
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
              enum: [Draft, Active, In Active]
          description: Campaign status
        current_step:
          type: integer
          minimum: 0
          maximum: 6
          description: Current step in campaign creation process
        front_template_id:
          type: string
          nullable: true
          description: PostGrid template ID for front of postcard
        back_template_id:
          type: string
          nullable: true
          description: PostGrid template ID for back of postcard
        offer_data:
          type: object
          description: Offer details (offer_headline, offer_description, start_date, end_date, cta_text, disclaimer_text)
        business_data:
          type: object
          description: Business details (business_name, phone, website, qr_url, before_image_url, after_image_url)
        additional_data:
          type: object
          description: Additional campaign data
        postcards_sent:
          type: integer
          default: 0
          description: Number of postcards sent
        scan_rate:
          type: number
          format: decimal
          default: 0.00
          description: Scan rate percentage
        leads_gen:
          type: integer
          default: 0
          description: Number of leads generated
        total_spent:
          type: number
          format: decimal
          default: 0.00
          description: Total amount spent
        roi:
          type: number
          format: decimal
          default: 0.00
          description: Return on investment
        created_at:
          type: string
          format: date-time
          description: Campaign creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Campaign last update timestamp

    CampaignHistoryEntry:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: History entry ID
        campaign_id:
          type: string
          format: uuid
          description: Campaign ID
        user_id:
          type: string
          format: uuid
          description: User who performed the action
        user_name:
          type: string
          description: Name of user who performed the action
        action:
          type: string
          description: Description of the action performed
        created_at:
          type: string
          format: date-time
          description: When the action was performed

    LocationZone:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Zone unique identifier
          example: "123e4567-e89b-12d3-a456-426614174000"
        organization_id:
          type: string
          format: uuid
          description: Organization ID that owns this zone
          example: "770e8400-e29b-41d4-a716-446655440003"
        campaign_id:
          type: string
          format: uuid
          nullable: true
          description: Campaign ID this zone is associated with
          example: "660e8400-e29b-41d4-a716-446655440001"
        center:
          type: object
          properties:
            lat:
              type: number
              description: Latitude of search center
              example: 37.4224764
            long:
              type: number
              description: Longitude of search center
              example: -122.0842499
            radius:
              type: integer
              description: Search radius in meters (only present in radius mode)
              example: 1000
        mode:
          type: string
          enum: [radius, count]
          description: Search mode used
          example: "radius"
        search_type:
          type: string
          enum: [ALL, RESIDENTIAL, OTHER]
          description: Type of buildings searched for
          example: "RESIDENTIAL"
        metadata:
          type: object
          properties:
            totalBuildingsFound:
              type: integer
              description: Total buildings found during search
              example: 45
            addressesReturned:
              type: integer
              description: Number of addresses returned
              example: 45
            residentialCount:
              type: integer
              description: Number of residential buildings
              example: 30
            otherCount:
              type: integer
              description: Number of non-residential buildings
              example: 15
            verified_count:
              type: integer
              description: Number of verified addresses (if verification was performed)
              example: 28
            unverified_count:
              type: integer
              description: Number of unverified addresses (if verification was performed)
              example: 17
            processingTimeMs:
              type: integer
              description: Processing time in milliseconds
              example: 2500
        addresses:
          type: array
          items:
            type: object
            properties:
              lat:
                type: number
                description: Address latitude
                example: 37.4225
              long:
                type: number
                description: Address longitude
                example: -122.0843
              address:
                type: string
                description: Full address string
                example: "1600 Amphitheatre Parkway, Mountain View, CA 94043"
              residential:
                type: boolean
                description: Whether this is a residential building
                example: true
              building_type:
                type: string
                description: Type of building from OpenStreetMap
                example: "house"
              osm_id:
                type: string
                description: OpenStreetMap ID
                example: "way/123456789"
              verified:
                type: boolean
                description: Whether address has been verified with PostGrid
                example: true
              verification_details:
                type: object
                nullable: true
                description: PostGrid verification details (if verified)
                properties:
                  status:
                    type: string
                    enum: [verified, corrected, undeliverable]
                    description: PostGrid verification status
                    example: "verified"
                  line1:
                    type: string
                    description: Verified street address
                    example: "1600 Amphitheatre Pkwy"
                  city:
                    type: string
                    description: Verified city
                    example: "Mountain View"
                  provinceOrState:
                    type: string
                    description: Verified state/province
                    example: "CA"
                  postalOrZip:
                    type: string
                    description: Verified postal/zip code
                    example: "94043"
                  error:
                    type: string
                    description: Error message if verification failed
                    example: null
              propertyType:
                type: string
                description: "Type of property (e.g., 'Single Family Home', 'Office Building', 'Warehouse')"
                example: "Single Family Home"
              distanceFromCenter:
                type: integer
                description: "Distance from search center point in meters"
                example: 847
              targeting_zone_name:
                type: string
                description: "Human-readable name of the targeting zone based on search address"
                example: "Mountain View, CA Area"
              campaigns_used_in:
                type: array
                items:
                  type: string
                description: "List of campaign names that have used this address"
                example: []
              zoneType:
                type: string
                description: "Type of zone search performed"
                example: "radius(1.0km)"
              postcards_sent:
                type: integer
                description: "Number of postcards sent to this address"
                example: 0
              first_post_card_sent_date:
                type: string
                format: date-time
                nullable: true
                description: "Date when first postcard was sent to this address"
                example: null
              status:
                type: string
                enum: ["Valid", "Duplicate", "Opt-out", "UnVerified"]
                description: "Verification status of the address"
                example: "UnVerified"
        created_at:
          type: string
          format: date-time
          description: Zone creation timestamp
          example: "2025-01-18T10:00:00.000Z"
        updated_at:
          type: string
          format: date-time
          description: Zone last update timestamp
          example: "2025-01-18T15:30:00.000Z"

    AddressObject:
      type: object
      properties:
        lat:
          type: number
          description: Address latitude
          example: 37.4225
        long:
          type: number
          description: Address longitude
          example: -122.0843
        address:
          type: string
          description: Full address string
          example: "1600 Amphitheatre Parkway, Mountain View, CA 94043"
        residential:
          type: boolean
          description: Whether this is a residential building
          example: true
        building_type:
          type: string
          description: Type of building from OpenStreetMap
          example: "house"
        osm_id:
          type: string
          description: OpenStreetMap ID
          example: "way/123456789"
        verified:
          type: boolean
          description: Whether address has been verified with PostGrid
          example: true
        verification_details:
          type: object
          nullable: true
          description: PostGrid verification details (if verified)
          properties:
            status:
              type: string
              enum: [verified, corrected, undeliverable]
              description: PostGrid verification status
              example: "verified"
            line1:
              type: string
              description: Verified street address
              example: "1600 Amphitheatre Pkwy"
            city:
              type: string
              description: Verified city
              example: "Mountain View"
            provinceOrState:
              type: string
              description: Verified state/province
              example: "CA"
            postalOrZip:
              type: string
              description: Verified postal/zip code
              example: "94043"
            error:
              type: string
              description: Error message if verification failed
              example: null
        propertyType:
          type: string
          description: "Type of property (e.g., 'Single Family Home', 'Office Building', 'Warehouse')"
          example: "Single Family Home"
        distanceFromCenter:
          type: integer
          description: "Distance from search center point in meters"
          example: 847
        targeting_zone_name:
          type: string
          description: "Human-readable name of the targeting zone based on search address"
          example: "Mountain View, CA Area"
        campaigns_used_in:
          type: array
          items:
            type: string
          description: "List of campaign names that have used this address"
          example: []
        zoneType:
          type: string
          description: "Type of zone search performed"
          example: "radius(1.0km)"
        postcards_sent:
          type: integer
          description: "Number of postcards sent to this address"
          example: 0
        first_post_card_sent_date:
          type: string
          format: date-time
          nullable: true
          description: "Date when first postcard was sent to this address"
          example: null
        status:
          type: string
          enum: ["Valid", "Duplicate", "Opt-out", "UnVerified"]
          description: "Verification status of the address"
          example: "UnVerified"
        createdBy:
          type: object
          description: "Information about the user who created or last modified this address"
          properties:
            id:
              type: string
              format: uuid
              description: "User ID"
              example: "98a88548-47d3-470d-ac40-ba10c9881d98"
            user_role:
              type: string
              enum: ["ADMIN", "MARKETER", "TECHNICIAN"]
              description: "User role"
              example: "ADMIN"
            full_name:
              type: string
              nullable: true
              description: "Full name of the user"
              example: "Admin User"
            created_at:
              type: string
              format: date-time
              description: "When the user profile was created"
              example: "2025-01-13T10:00:00.000Z"
            updated_at:
              type: string
              format: date-time
              description: "When the user profile was last updated"
              example: "2025-01-13T10:00:00.000Z"

    CreatedByInfo:
      type: object
      description: "Information about the user who created or last modified an entity"
      properties:
        id:
          type: string
          format: uuid
          description: "User ID"
          example: "98a88548-47d3-470d-ac40-ba10c9881d98"
        user_role:
          type: string
          enum: ["ADMIN", "MARKETER", "TECHNICIAN"]
          description: "User role"
          example: "ADMIN"
        full_name:
          type: string
          nullable: true
          description: "Full name of the user"
          example: "Admin User"
        created_at:
          type: string
          format: date-time
          description: "When the user profile was created"
          example: "2025-01-13T10:00:00.000Z"
        updated_at:
          type: string
          format: date-time
          description: "When the user profile was last updated"
          example: "2025-01-13T10:00:00.000Z"

  securitySchemes:
    SupabaseAuth:
      type: apiKey
      in: header
      name: apikey
      description: |
        Supabase anon/public key. Required for all requests to Supabase Edge Functions.
        Get this from your Supabase Dashboard > Project Settings > API > anon/public key.
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT access token obtained from /login endpoint.
        Include in Authorization header as: Bearer <token>
        Required for authenticated endpoints including campaigns, zones, referrals, and admin operations.
